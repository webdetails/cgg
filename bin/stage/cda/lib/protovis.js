// 6ff1e4c
if(!Array.prototype.map){Array.prototype.map=function(c,d){var e=this.length;var a=new Array(e);for(var b=0;b<e;b++){if(b in this){a[b]=c.call(d,this[b],b,this)}}return a}}if(!Array.prototype.filter){Array.prototype.filter=function(d,e){var g=this.length;var a=new Array();for(var c=0;c<g;c++){if(c in this){var b=this[c];if(d.call(e,b,c,this)){a.push(b)}}}return a}}if(!Array.prototype.forEach){Array.prototype.forEach=function(b,c){var d=this.length>>>0;for(var a=0;a<d;a++){if(a in this){b.call(c,this[a],a,this)}}}}if(!Array.prototype.reduce){Array.prototype.reduce=function(d,b){var a=this.length;if(!a&&(arguments.length==1)){throw new Error("reduce: empty array, no initial value")}var c=0;if(arguments.length<2){while(true){if(c in this){b=this[c++];break}if(++c>=a){throw new Error("reduce: no values, no initial value")}}}for(;c<a;c++){if(c in this){b=d(b,this[c],c,this)}}return b}};var pv={};pv.version={major:3,minor:2};pv.identity=function(a){return a};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};pv.parent=function(){return this.parent.index};pv.extend=function(b){function a(){}a.prototype=b.prototype||b;return new a()};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(a){var n=new RegExp("function(\\s+\\w+)?\\([^)]*\\)\\s*","mg"),f,k,h=0,o="";while(f=n.exec(a)){var g=f.index+f[0].length;if(a.charAt(g)!="{"){o+=a.substring(h,g)+"{return ";h=g;for(var b=0;b>=0&&g<a.length;g++){var l=a.charAt(g);switch(l){case'"':case"'":while(++g<a.length&&(k=a.charAt(g))!=l){if(k=="\\"){g++}}break;case"[":case"(":b++;break;case"]":case")":b--;break;case";":case",":if(b==0){b--}break}}o+=pv.parse(a.substring(h,--g))+";}";h=g}n.lastIndex=g}o+=a.substring(h);return o}}pv.css=function(b,a){return window.getComputedStyle?window.getComputedStyle(b,null).getPropertyValue(a):b.currentStyle[a]};pv.error=function(a){(typeof console=="undefined")?alert(a):console.error(a)};pv.listen=function(d,a,b){b=pv.listener(b);return d.addEventListener?d.addEventListener(a,b,false):d.attachEvent("on"+a,b)};pv.listener=function(a){return function(b){try{pv.event=b;return a(b)}finally{delete pv.event}}};pv.id=function(){var a=1;return function(){return a++}}();pv.Format={};pv.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(f,d,b){var a=d-String(b).length;return(a<1)?b:new Array(a+1).join(f)+b};pv.Format.date=function(a){var d=pv.Format.pad;function b(f){return a.replace(/%[a-zA-Z0-9]/g,function(j){switch(j){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][f.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][f.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][f.getMonth()];case"%c":return f.toLocaleString();case"%C":return d("0",2,Math.floor(f.getFullYear()/100)%100);case"%d":return d("0",2,f.getDate());case"%x":case"%D":return d("0",2,f.getMonth()+1)+"/"+d("0",2,f.getDate())+"/"+d("0",2,f.getFullYear()%100);case"%e":return d(" ",2,f.getDate());case"%H":return d("0",2,f.getHours());case"%I":var i=f.getHours()%12;return i?d("0",2,i):12;case"%m":return d("0",2,f.getMonth()+1);case"%M":return d("0",2,f.getMinutes());case"%n":return"\n";case"%p":return f.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var i=f.getHours()%12;return(i?d("0",2,i):12)+":"+d("0",2,f.getMinutes())+":"+d("0",2,f.getSeconds())+" "+(f.getHours()<12?"AM":"PM");case"%R":return d("0",2,f.getHours())+":"+d("0",2,f.getMinutes());case"%S":return d("0",2,f.getSeconds());case"%Q":return d("0",3,f.getMilliseconds());case"%t":return"\t";case"%u":var g=f.getDay();return g?g:1;case"%w":return f.getDay();case"%y":return d("0",2,f.getFullYear()%100);case"%Y":return f.getFullYear();case"%%":return"%"}return j})}b.parse=function(o){var m=1970,l=0,g=1,i=0,h=0,f=0;var k=[function(){}];var n=pv.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(p){switch(p){case"%b":k.push(function(q){l={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[q]});return"([A-Za-z]+)";case"%h":case"%B":k.push(function(q){l={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[q]});return"([A-Za-z]+)";case"%e":case"%d":k.push(function(q){g=q});return"([0-9]+)";case"%I":case"%H":k.push(function(q){i=q});return"([0-9]+)";case"%m":k.push(function(q){l=q-1});return"([0-9]+)";case"%M":k.push(function(q){h=q});return"([0-9]+)";case"%p":k.push(function(q){if(i==12){if(q=="am"){i=0}}else{if(q=="pm"){i=Number(i)+12}}});return"(am|pm)";case"%S":k.push(function(q){f=q});return"([0-9]+)";case"%y":k.push(function(q){q=Number(q);m=q+(((0<=q)&&(q<69))?2000:(((q>=69)&&(q<100)?1900:0)))});return"([0-9]+)";case"%Y":k.push(function(q){m=q});return"([0-9]+)";case"%%":k.push(function(){});return"%"}return p});var j=o.match(n);if(j){j.forEach(function(p,q){k[q](p)})}return new Date(m,l,g,i,h,f)};return b};pv.Format.time=function(a){var d=pv.Format.pad;function b(i){i=Number(i);switch(a){case"short":if(i>=31536000000){return(i/31536000000).toFixed(1)+" years"}else{if(i>=604800000){return(i/604800000).toFixed(1)+" weeks"}else{if(i>=86400000){return(i/86400000).toFixed(1)+" days"}else{if(i>=3600000){return(i/3600000).toFixed(1)+" hours"}else{if(i>=60000){return(i/60000).toFixed(1)+" minutes"}}}}}return(i/1000).toFixed(1)+" seconds";case"long":var g=[],k=((i%60000)/1000)>>0,f=((i%3600000)/60000)>>0;g.push(d("0",2,k));if(i>=3600000){var j=((i%86400000)/3600000)>>0;g.push(d("0",2,f));if(i>=86400000){g.push(d("0",2,j));g.push(Math.floor(i/86400000).toFixed())}else{g.push(j.toFixed())}}else{g.push(f.toFixed())}return g.reverse().join(":")}}b.parse=function(k){switch(a){case"short":var j=/([0-9,.]+)\s*([a-z]+)/g,g,i=0;while(g=j.exec(k)){var l=parseFloat(g[0].replace(",","")),h=0;switch(g[2].toLowerCase()){case"year":case"years":h=31536000000;break;case"week":case"weeks":h=604800000;break;case"day":case"days":h=86400000;break;case"hour":case"hours":h=3600000;break;case"minute":case"minutes":h=60000;break;case"second":case"seconds":h=1000;break}i+=l*h}return i;case"long":var g=k.replace(",","").split(":").reverse(),i=0;if(g.length){i+=parseFloat(g[0])*1000}if(g.length>1){i+=parseFloat(g[1])*60000}if(g.length>2){i+=parseFloat(g[2])*3600000}if(g.length>3){i+=parseFloat(g[3])*86400000}return i}};return b};pv.Format.number=function(){var i=0,d=Infinity,a=0,l=0,g=0,b=1,h="0",k="0",j=true,f=".",n=",";function m(o){if(Infinity>g){o=Math.round(o*b)/b}var q=String(Math.abs(o)).split(".");var p=q[0],u=(o<0)?"-":"";if(p.length>d){p=p.substring(p.length-d)}if(j&&(p.length<i)){p=u+new Array(i-p.length+1).join(h)+p}if(p.length>3){p=p.replace(/\B(?=(?:\d{3})+(?!\d))/g,n)}if(!j&&(p.length<a)){p=new Array(a-p.length+1).join(h)+u+p}q[0]=p;var t=q[1]||"";if(t.length<l){q[1]=t+new Array(l-t.length+1).join(k)}return q.join(f)}m.parse=function(o){var t=pv.Format.re;var q=String(o).replace(new RegExp("^("+t(h)+")*"),"").replace(new RegExp("("+t(k)+")*$"),"").split(f);var p=q[0].replace(new RegExp(t(n),"g"),"");if(p.length>d){p=p.substring(p.length-d)}var u=q[1]?Number("0."+q[1]):0;if(Infinity>g){u=Math.round(u*b)/b}return Math.round(p)+u};m.integerDigits=function(p,o){if(arguments.length){i=Number(p);d=(arguments.length>1)?Number(o):i;a=i+Math.floor(i/3)*n.length;return this}return[i,d]};m.fractionDigits=function(p,o){if(arguments.length){l=Number(p);g=(arguments.length>1)?Number(o):l;b=Math.pow(10,g);return this}return[l,g]};m.integerPad=function(o){if(arguments.length){h=String(o);j=/\d/.test(h);return this}return h};m.fractionPad=function(o){if(arguments.length){k=String(o);return this}return k};m.decimal=function(o){if(arguments.length){f=String(o);return this}return f};m.group=function(o){if(arguments.length){n=o?String(o):"";a=i+Math.floor(i/3)*n.length;return this}return n};return m};pv.Format.csv=function(){return new pv.CsvFormat()};pv.CsvFormat=function(){};pv.CsvFormat.prototype.header=function(a){if(arguments.length){this.$header=a;return this}return this.$header};pv.CsvFormat.prototype.parse=function(v){var d={},i={},u=[],p=/[,\n]/g,q,l;function f(){if(p.lastIndex==v.length){return i}if(l){l=false;return d}var k=p.lastIndex;if(v.charAt(k)=='"'){var o=k;out:while(o++<v.length){switch(v.charAt(o)){case'"':if(v.charAt(o+1)=='"'){o++;break}break out}}if(v.charAt(o+1)=="\n"){l=true}p.lastIndex=o+2;return v.substring(k+1,o).replace(/""/g,'"')}var a=p.exec(v);if(a){if(a[0]=="\n"){l=true}return v.substring(k,a.index)}p.lastIndex=v.length;return v.substring(k)}if(this.$header){var n=[];while(((q=f())!==d)&&(q!==i)){n.push(q)}var g=0;while((q=f())!==i){var b={},h=0;u.push(b);while((q!==d)&&(q!==i)){b[n[h++]]=q;q=f()}}}else{while((q=f())!==i){var m=[];u.push(m);while((q!==d)&&(q!==i)){m.push(q);q=f()}}}return u};pv.CsvFormat.prototype.format=function(d){if(!d.length){return""}var b=[];if(this.$header){var g=pv.keys(d[0]);b.push(g.map(pv.CsvFormat.quote).join(","));for(var f=0;f<d.length;f++){b.push(g.map(function(a){return pv.CsvFormat.quote(d[f][a])}).join(","))}}else{for(var f=0;f<d.length;f++){b.push(d[f].map(pv.CsvFormat.quote).join(","))}}return b.join("\n")};pv.CsvFormat.quote=function(a){return/[",\n]/.test(a)?('"'+a.replace(/\"/g,'""')+'"'):a};pv.map=function(d,a){var b={};return a?d.map(function(g,f){b.index=f;return a.call(b,g)}):d.slice()};pv.repeat=function(b,a){if(arguments.length==1){a=2}return pv.blend(pv.range(a).map(function(){return b}))};pv.cross=function(h,g){var p=[];for(var l=0,o=h.length,f=g.length;l<o;l++){for(var k=0,d=h[l];k<f;k++){p.push([d,g[k]])}}return p};pv.blend=function(a){return Array.prototype.concat.apply([],a)};pv.transpose=function(g){var h=g.length,a=pv.max(g,function(i){return i.length});if(a>h){g.length=a;for(var f=h;f<a;f++){g[f]=new Array(h)}for(var f=0;f<h;f++){for(var b=f+1;b<a;b++){var d=g[f][b];g[f][b]=g[b][f];g[b][f]=d}}}else{for(var f=0;f<a;f++){g[f].length=h}for(var f=0;f<h;f++){for(var b=0;b<f;b++){var d=g[f][b];g[f][b]=g[b][f];g[b][f]=d}}}g.length=a;for(var f=0;f<a;f++){g[f].length=h}return g};pv.normalize=function(h,g){var b=pv.map(h,g),d=pv.sum(b);for(var a=0;a<b.length;a++){b[a]/=d}return b};pv.permute=function(h,a,b){if(!b){b=pv.identity}var d=new Array(a.length),g={};a.forEach(function(f,k){g.index=f;d[k]=b.call(g,h[f])});return d};pv.numerate=function(a,b){if(!b){b=pv.identity}var d={},g={};a.forEach(function(f,h){g.index=h;d[b.call(g,f)]=h});return d};pv.naturalOrder=function(f,d){return(f<d)?-1:((f>d)?1:0)};pv.reverseOrder=function(d,f){return(f<d)?-1:((f>d)?1:0)};pv.search=function(j,i,h){if(!h){h=pv.identity}var a=0,g=j.length-1;while(a<=g){var b=(a+g)>>1,d=h(j[b]);if(d<i){a=b+1}else{if(d>i){g=b-1}else{return b}}}return -a-1};pv.search.index=function(g,d,b){var a=pv.search(g,d,b);return(a<0)?(-a-1):a};pv.range=function(h,d,f){if(arguments.length==1){d=h;h=0}if(f==undefined){f=1}else{if(!f){throw new Error("step must be non-zero")}}var g=[],b=0,a;if(f<0){while((a=h+f*b++)>d){g.push(a)}}else{while((a=h+f*b++)<d){g.push(a)}}return g};pv.random=function(b,a,d){if(arguments.length==1){a=b;b=0}if(d==undefined){d=1}return d?(Math.floor(Math.random()*(a-b)/d)*d+b):(Math.random()*(a-b)+b)};pv.sum=function(d,a){var b={};return d.reduce(a?function(g,h,f){b.index=f;return g+a.call(b,h)}:function(f,g){return f+g},0)};pv.max=function(b,a){if(a==pv.index){return b.length-1}return Math.max.apply(null,a?pv.map(b,a):b)};pv.max.index=function(k,g){if(g==pv.index){return k.length-1}if(!g){g=pv.identity}var b=-1,j=-Infinity,h={};for(var d=0;d<k.length;d++){h.index=d;var a=g.call(h,k[d]);if(a>j){j=a;b=d}}return b};pv.min=function(b,a){if(a==pv.index){return 0}return Math.min.apply(null,a?pv.map(b,a):b)};pv.min.index=function(k,h){if(h==pv.index){return 0}if(!h){h=pv.identity}var g=-1,b=Infinity,j={};for(var d=0;d<k.length;d++){j.index=d;var a=h.call(j,k[d]);if(a<b){b=a;g=d}}return g};pv.mean=function(b,a){return pv.sum(b,a)/b.length};pv.median=function(d,b){if(b==pv.index){return(d.length-1)/2}d=pv.map(d,b).sort(pv.naturalOrder);if(d.length%2){return d[Math.floor(d.length/2)]}var a=d.length/2;return(d[a-1]+d[a])/2};pv.variance=function(l,h){var a=pv.mean(l,h),g=0,k={};if(!h){h=pv.identity}for(var b=0;b<l.length;b++){k.index=b;var j=h.call(k,l[b])-a;g+=j*j}return g};pv.stddev=function(b,a){return Math.sqrt(pv.variance(b,a)/(b.length-1))};pv.log=function(d,a){return Math.log(d)/Math.log(a)};pv.logSymmetric=function(d,a){return(d==0)?0:((d<0)?-pv.log(-d,a):pv.log(d,a))};pv.logAdjusted=function(d,a){var f=d<0;if(d<a){d+=(a-d)/a}return f?-pv.log(d,a):pv.log(d,a)};pv.logFloor=function(d,a){return(d>0)?Math.pow(a,Math.floor(pv.log(d,a))):-Math.pow(a,-Math.floor(-pv.log(-d,a)))};pv.logCeil=function(d,a){return(d>0)?Math.pow(a,Math.ceil(pv.log(d,a))):-Math.pow(a,-Math.ceil(-pv.log(-d,a)))};pv.keys=function(b){var d=[];for(var a in b){d.push(a)}return d};pv.entries=function(b){var d=[];for(var a in b){d.push({key:a,value:b[a]})}return d};pv.values=function(b){var d=[];for(var a in b){d.push(b[a])}return d};pv.dict=function(g,h){var a={},j={};for(var d=0;d<g.length;d++){if(d in g){var b=g[d];j.index=d;a[b]=h.call(j,b)}}return a};pv.dom=function(a){return new pv.Dom(a)};pv.Dom=function(a){this.$map=a};pv.Dom.prototype.$leaf=function(a){return typeof a!="object"};pv.Dom.prototype.leaf=function(a){if(arguments.length){this.$leaf=a;return this}return this.$leaf};pv.Dom.prototype.root=function(f){var b=this.$leaf,a=d(this.$map);function d(i){var j=new pv.Dom.Node();for(var h in i){var g=i[h];j.appendChild(b(g)?new pv.Dom.Node(g):d(g)).nodeName=h}return j}a.nodeName=f;return a};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(a){this.nodeValue=a;this.childNodes=[]};pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype.removeChild=function(b){var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}this.childNodes.splice(a,1);if(b.previousSibling){b.previousSibling.nextSibling=b.nextSibling}else{this.firstChild=b.nextSibling}if(b.nextSibling){b.nextSibling.previousSibling=b.previousSibling}else{this.lastChild=b.previousSibling}delete b.nextSibling;delete b.previousSibling;delete b.parentNode;return b};pv.Dom.Node.prototype.appendChild=function(a){if(a.parentNode){a.parentNode.removeChild(a)}a.parentNode=this;a.previousSibling=this.lastChild;if(this.lastChild){this.lastChild.nextSibling=a}else{this.firstChild=a}this.lastChild=a;this.childNodes.push(a);return a};pv.Dom.Node.prototype.insertBefore=function(d,b){if(!b){return this.appendChild(d)}var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}if(d.parentNode){d.parentNode.removeChild(d)}d.parentNode=this;d.nextSibling=b;d.previousSibling=b.previousSibling;if(b.previousSibling){b.previousSibling.nextSibling=d}else{if(b==this.lastChild){this.lastChild=d}this.firstChild=d}this.childNodes.splice(a,0,d);return d};pv.Dom.Node.prototype.replaceChild=function(d,b){var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}if(d.parentNode){d.parentNode.removeChild(d)}d.parentNode=this;d.nextSibling=b.nextSibling;d.previousSibling=b.previousSibling;if(b.previousSibling){b.previousSibling.nextSibling=d}else{this.firstChild=d}if(b.nextSibling){b.nextSibling.previousSibling=d}else{this.lastChild=d}this.childNodes[a]=d;return b};pv.Dom.Node.prototype.visitBefore=function(b){function a(g,d){b(g,d);for(var f=g.firstChild;f;f=f.nextSibling){a(f,d+1)}}a(this,0)};pv.Dom.Node.prototype.visitAfter=function(b){function a(g,d){for(var f=g.firstChild;f;f=f.nextSibling){a(f,d+1)}b(g,d)}a(this,0)};pv.Dom.Node.prototype.sort=function(b){if(this.firstChild){this.childNodes.sort(b);var d=this.firstChild=this.childNodes[0],g;delete d.previousSibling;for(var a=1;a<this.childNodes.length;a++){d.sort(b);g=this.childNodes[a];g.previousSibling=d;d=d.nextSibling=g}this.lastChild=d;delete d.nextSibling;d.sort(b)}return this};pv.Dom.Node.prototype.nodes=function(){var b=[];function a(d){b.push(d);d.childNodes.forEach(a)}a(this,b);return b};pv.tree=function(a){return new pv.Tree(a)};pv.Tree=function(a){this.array=a};pv.Tree.prototype.keys=function(a){this.k=a;return this};pv.Tree.prototype.value=function(a){this.v=a;return this};pv.Tree.prototype.map=function(){var h={},k={};for(var b=0;b<this.array.length;b++){k.index=b;var g=this.array[b],f=this.k.call(k,g),d=h;for(var a=0;a<f.length-1;a++){d=d[f[a]]||(d[f[a]]={})}d[f[a]]=this.v?this.v.call(k,g):g}return h};pv.nest=function(a){return new pv.Nest(a)};pv.Nest=function(a){this.array=a;this.keys=[]};pv.Nest.prototype.key=function(a){this.keys.push(a);return this};pv.Nest.prototype.sortKeys=function(a){this.keys[this.keys.length-1].order=a||pv.naturalOrder;return this};pv.Nest.prototype.sortValues=function(a){this.order=a||pv.naturalOrder;return this};pv.Nest.prototype.map=function(){var o={},h=[];for(var n,l=0;l<this.array.length;l++){var d=this.array[l];var b=o;for(n=0;n<this.keys.length-1;n++){var g=this.keys[n](d);if(!b[g]){b[g]={}}b=b[g]}g=this.keys[n](d);if(!b[g]){var f=[];h.push(f);b[g]=f}b[g].push(d)}if(this.order){for(var n=0;n<h.length;n++){h[n].sort(this.order)}}return o};pv.Nest.prototype.entries=function(){function a(g){var h=[];for(var f in g){var d=g[f];h.push({key:f,values:(d instanceof Array)?d:a(d)})}return h}function b(h,f){var g=this.keys[f].order;if(g){h.sort(function(j,i){return g(j.key,i.key)})}if(++f<this.keys.length){for(var d=0;d<h.length;d++){b.call(this,h[d].values,f)}}return h}return b.call(this,a(this.map()),0)};pv.Nest.prototype.rollup=function(b){function a(g){for(var d in g){var f=g[d];if(f instanceof Array){g[d]=b(f)}else{a(f)}}return g}return a(this.map())};pv.flatten=function(a){return new pv.Flatten(a)};pv.Flatten=function(a){this.map=a;this.keys=[]};pv.Flatten.prototype.key=function(a,b){this.keys.push({name:a,value:b});return this};pv.Flatten.prototype.array=function(){var b=[],a=[],f=this.keys;function d(j,h){if(h<f.length-1){for(var g in j){a.push(g);d(j[g],h+1);a.pop()}}else{b.push(a.concat(j))}}d(this.map,0);return b.map(function(h){var g={};for(var n=0;n<f.length;n++){var l=f[n],j=h[n];g[l.name]=l.value?l.value.call(null,j):j}return g})};pv.vector=function(a,b){return new pv.Vector(a,b)};pv.Vector=function(a,b){this.x=a;this.y=b};pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)};pv.Vector.prototype.norm=function(){var a=this.length();return this.times(a?(1/a):1)};pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};pv.Vector.prototype.times=function(a){return new pv.Vector(this.x*a,this.y*a)};pv.Vector.prototype.plus=function(a,b){return(arguments.length==1)?new pv.Vector(this.x+a.x,this.y+a.y):new pv.Vector(this.x+a,this.y+b)};pv.Vector.prototype.minus=function(a,b){return(arguments.length==1)?new pv.Vector(this.x-a.x,this.y-a.y):new pv.Vector(this.x-a,this.y-b)};pv.Vector.prototype.dot=function(a,b){return(arguments.length==1)?this.x*a.x+this.y*a.y:this.x*a+this.y*b};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(a,d){var b=new pv.Transform();b.k=this.k;b.x=this.k*a+this.x;b.y=this.k*d+this.y;return b};pv.Transform.prototype.scale=function(b){var a=new pv.Transform();a.k=this.k*b;a.x=this.x;a.y=this.y;return a};pv.Transform.prototype.invert=function(){var b=new pv.Transform(),a=1/this.k;b.k=a;b.x=-this.x*a;b.y=-this.y*a;return b};pv.Transform.prototype.times=function(a){var b=new pv.Transform();b.k=this.k*a.k;b.x=this.k*a.x+this.x;b.y=this.k*a.y+this.y;return b};pv.Scale=function(){};pv.Scale.interpolator=function(b,a){if(typeof b=="number"){return function(d){return d*(a-b)+b}}b=pv.color(b).rgb();a=pv.color(a).rgb();return function(f){var d=b.a*(1-f)+a.a*f;if(d<0.00001){d=0}return(b.a==0)?pv.rgb(a.r,a.g,a.b,d):((a.a==0)?pv.rgb(b.r,b.g,b.b,d):pv.rgb(Math.round(b.r*(1-f)+a.r*f),Math.round(b.g*(1-f)+a.g*f),Math.round(b.b*(1-f)+a.b*f),d))}};pv.Scale.linear=function(){var j=[0,1],g=[0,1],b=[pv.identity],f=Number;function a(d){return new Date(d)}function h(d){var i=pv.search(j,d);if(i<0){i=-i-2}i=Math.max(0,Math.min(b.length-1,i));return b[i]((d-j[i])/(j[i+1]-j[i]))}h.domain=function(l,i,d){if(arguments.length){var k;if(l instanceof Array){if(arguments.length<2){i=pv.identity}if(arguments.length<3){d=i}k=l.length&&i(l[0]);j=[pv.min(l,i),pv.max(l,d)]}else{k=l;j=Array.prototype.slice.call(arguments).map(Number)}f=(k instanceof Date)?a:Number;return this}return j.map(f)};h.range=function(){if(arguments.length){g=Array.prototype.slice.call(arguments);b=[];for(var d=0;d<g.length-1;d++){b.push(pv.Scale.interpolator(g[d],g[d+1]))}return this}return g};h.invert=function(i){var d=pv.search(g,i);if(d<0){d=-d-2}d=Math.max(0,Math.min(b.length-1,d));return f((i-g[d])/(g[d+1]-g[d])*(j[d+1]-j[d])+j[d])};h.ticks=function(){var p=j[0],t=j[j.length-1],v=t-p;if(f==a){function s(x,n){switch(n){case 31536000000:x.setMonth(0);case 2592000000:x.setDate(1);case 604800000:if(n==604800000){x.setDate(x.getDate()-x.getDay())}case 86400000:x.setHours(0);case 3600000:x.setMinutes(0);case 60000:x.setSeconds(0);case 1000:x.setMilliseconds(0)}}var q,u,w,l=1;if(v>=2*31536000000){q=31536000000;u="%Y";w=function(n){n.setFullYear(n.getFullYear()+l)}}else{if(v>=2*2592000000){q=2592000000;u="%m/%Y";w=function(n){n.setMonth(n.getMonth()+l)}}else{if(v>=2*604800000){q=604800000;u="%m/%d";w=function(n){n.setDate(n.getDate()+7*l)}}else{if(v>=2*86400000){q=86400000;u="%m/%d";w=function(n){n.setDate(n.getDate()+l)}}else{if(v>=2*3600000){q=3600000;u="%I:%M %p";w=function(n){n.setHours(n.getHours()+l)}}else{if(v>=3*60000){q=60000;u="%I:%M %p";w=function(n){n.setMinutes(n.getMinutes()+l)}}else{if(v>=3*1000){q=1000;u="%I:%M:%S";w=function(n){n.setSeconds(n.getSeconds()+l)}}else{q=1;u="%S.%Qs";w=function(n){n.setTime(n.getTime()+l)}}}}}}}}var m=new Date(p),d=[];s(m,q);var k=v/q;if(k>10){switch(q){case 3600000:l=(k>20)?6:3;m.setHours(Math.floor(m.getHours()/l)*l);break;case 2592000000:l=3;m.setMonth(Math.floor(m.getMonth()/l)*l);break;case 60000:l=(k>30)?15:((k>15)?10:5);m.setMinutes(Math.floor(m.getMinutes()/l)*l);break;case 1000:l=(k>90)?15:((k>60)?10:5);m.setSeconds(Math.floor(m.getSeconds()/l)*l);break;case 1:l=(k>1000)?250:((k>200)?100:((k>100)?50:((k>50)?25:5)));m.setMilliseconds(Math.floor(m.getMilliseconds()/l)*l);break;default:l=pv.logCeil(k/15,10);if(k/l<2){l/=2}else{if(k/l<5){l/=2}}m.setFullYear(Math.floor(m.getFullYear()/l)*l);break}}h.tickFormat=pv.Format.date(u);while(true){w(m);if(m>t){break}d.push(new Date(m))}return d}var l=pv.logCeil(v/15,10);if(v/l<2){l/=5}else{if(v/l<5){l/=2}}var i=Math.ceil(p/l)*l,o=Math.floor(t/l)*l,q=Math.max(0,-Math.floor(pv.log(l,10)+0.01));h.tickFormat=function(n){return n.toFixed(q)};return pv.range(i,o+l,l)};h.nice=function(){var i=j[0],d=j[j.length-1],k=Math.pow(10,Math.round(Math.log(d-i)/Math.log(10))-1);j=[Math.floor(i/k)*k,Math.ceil(d/k)*k];return this};h.by=function(d){function i(){return h(d.apply(this,arguments))}for(var k in h){i[k]=h[k]}return i};h.domain.apply(h,arguments);return h};pv.Scale.log=function(){var m=[1,10],f=[0,1],a=10,j=[0,1],g=[pv.identity];function k(b){var d=pv.search(m,b);if(d<0){d=-d-2}d=Math.max(0,Math.min(g.length-1,d));return g[d]((h(b)-f[d])/(f[d+1]-f[d]))}function h(b){return pv.logSymmetric(b,a)}k.domain=function(i,d,b){if(arguments.length){if(i instanceof Array){if(arguments.length<2){d=pv.identity}if(arguments.length<3){b=d}m=[pv.min(i,d),pv.max(i,b)]}else{m=Array.prototype.slice.call(arguments)}f=m.map(h);return this}return m};k.range=function(){if(arguments.length){j=Array.prototype.slice.call(arguments);g=[];for(var b=0;b<j.length-1;b++){g.push(pv.Scale.interpolator(j[b],j[b+1]))}return this}return j};k.invert=function(i){var b=pv.search(j,i);if(b<0){b=-b-2}b=Math.max(0,Math.min(g.length-1,b));var d=f[b]+(i-j[b])/(j[b+1]-j[b])*(f[b+1]-f[b]);return(m[b]<0)?-Math.pow(a,-d):Math.pow(a,d)};k.ticks=function(){var p=Math.floor(f[0]),d=Math.ceil(f[1]),o=[];for(var n=p;n<d;n++){var b=Math.pow(a,n);if(m[0]<0){b=-b}for(var l=1;l<a;l++){o.push(b*l)}}o.push(Math.pow(a,d));if(o[0]<m[0]){o.shift()}if(o[o.length-1]>m[1]){o.pop()}return o};k.tickFormat=function(b){return b.toPrecision(1)};k.nice=function(){m=[pv.logFloor(m[0],a),pv.logCeil(m[1],a)];f=m.map(h);return this};k.base=function(b){if(arguments.length){a=b;f=m.map(h);return this}return a};k.by=function(b){function d(){return k(b.apply(this,arguments))}for(var i in k){d[i]=k[i]}return d};k.domain.apply(k,arguments);return k};pv.Scale.ordinal=function(){var h=[],a={},b=[],g=0;function f(d){if(!(d in a)){a[d]=h.push(d)-1}return b[a[d]%b.length]}f.domain=function(m,k){if(arguments.length){m=(m instanceof Array)?((arguments.length>1)?pv.map(m,k):m):Array.prototype.slice.call(arguments);h=[];var d={};for(var i=0;i<m.length;i++){var l=m[i];if(!(l in d)){d[l]=true;h.push(l)}}a=pv.numerate(h);return this}return h};f.range=function(i,d){if(arguments.length){b=(i instanceof Array)?((arguments.length>1)?pv.map(i,d):i):Array.prototype.slice.call(arguments);if(typeof b[0]=="string"){b=b.map(pv.color)}return this}return b};f.split=function(i,d){var j=(d-i)/this.domain().length;b=pv.range(i+j/2,d,j);return this};f.splitFlush=function(i,d){var k=this.domain().length,j=(d-i)/(k-1);b=(k==1)?[(i+d)/2]:pv.range(i,d+j/2,j);return this};f.splitBanded=function(i,d,o){if(arguments.length<3){o=1}if(o<0){var p=this.domain().length,l=-o*p,j=d-i-l,m=j/(p+1);b=pv.range(i+m,d,m-o);b.band=-o}else{var k=(d-i)/(this.domain().length+(1-o));b=pv.range(i+k*(1-o),d,k);b.band=k*o}return this};f.by=function(d){function i(){return f(d.apply(this,arguments))}for(var j in f){i[j]=f[j]}return i};f.domain.apply(f,arguments);return f};pv.color=function(o){if(o=="transparent"){return pv.Color.transparent}if(o instanceof pv.Color){return o.rgb()}var q=/([a-z]+)\((.*)\)/i.exec(o);if(q){var p=q[2].split(","),n=1;switch(q[1]){case"hsla":case"rgba":n=parseFloat(p[3]);if(!n){return pv.Color.transparent}break}switch(q[1]){case"hsla":case"hsl":var j=parseFloat(p[0]),t=parseFloat(p[1])/100,f=parseFloat(p[2])/100;return(new pv.Color.Hsl(j,t,f,n)).rgb();case"rgba":case"rgb":function i(b){var a=parseFloat(b);return(b[b.length-1]=="%")?Math.round(a*2.55):a}var d=i(p[0]),k=i(p[1]),m=i(p[2]);return pv.rgb(d,k,m,n)}}o=pv.Color.names[o]||o;if(o.charAt(0)=="#"){var d,k,m;if(o.length==4){d=o.charAt(1);d+=d;k=o.charAt(2);k+=k;m=o.charAt(3);m+=m}else{if(o.length==7){d=o.substring(1,3);k=o.substring(3,5);m=o.substring(5,7)}}return pv.rgb(parseInt(d,16),parseInt(k,16),parseInt(m,16),1)}return new pv.Color(o,1)};pv.Color=function(a,b){this.color=a;this.opacity=b};pv.Color.prototype.brighter=function(a){return this.rgb().brighter(a)};pv.Color.prototype.darker=function(a){return this.rgb().darker(a)};pv.rgb=function(i,h,d,f){return new pv.Color.Rgb(i,h,d,(arguments.length==4)?f:1)};pv.Color.Rgb=function(i,h,d,f){pv.Color.call(this,f?("rgb("+i+","+h+","+d+")"):"none",f);this.r=i;this.g=h;this.b=d;this.a=f};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(a){return pv.rgb(a,this.g,this.b,this.a)};pv.Color.Rgb.prototype.green=function(a){return pv.rgb(this.r,a,this.b,this.a)};pv.Color.Rgb.prototype.blue=function(a){return pv.rgb(this.r,this.g,a,this.a)};pv.Color.Rgb.prototype.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};pv.Color.Rgb.prototype.rgb=function(){return this};pv.Color.Rgb.prototype.brighter=function(d){d=Math.pow(0.7,arguments.length?d:1);var j=this.r,h=this.g,a=this.b,f=30;if(!j&&!h&&!a){return pv.rgb(f,f,f,this.a)}if(j&&(j<f)){j=f}if(h&&(h<f)){h=f}if(a&&(a<f)){a=f}return pv.rgb(Math.min(255,Math.floor(j/d)),Math.min(255,Math.floor(h/d)),Math.min(255,Math.floor(a/d)),this.a)};pv.Color.Rgb.prototype.darker=function(a){a=Math.pow(0.7,arguments.length?a:1);return pv.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)};pv.hsl=function(g,f,d,b){return new pv.Color.Hsl(g,f,d,(arguments.length==4)?b:1)};pv.Color.Hsl=function(g,f,d,b){pv.Color.call(this,"hsl("+g+","+(f*100)+"%,"+(d*100)+"%)",b);this.h=g;this.s=f;this.l=d;this.a=b};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hue=function(a){return pv.hsl(a,this.s,this.l,this.a)};pv.Color.Hsl.prototype.saturation=function(a){return pv.hsl(this.h,a,this.l,this.a)};pv.Color.Hsl.prototype.lightness=function(a){return pv.hsl(this.h,this.s,a,this.a)};pv.Color.Hsl.prototype.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};pv.Color.Hsl.prototype.rgb=function(){var i=this.h,g=this.s,a=this.l;i=i%360;if(i<0){i+=360}g=Math.max(0,Math.min(g,1));a=Math.max(0,Math.min(a,1));var d=(a<=0.5)?(a*(1+g)):(a+g-a*g);var f=2*a-d;function b(k){if(k>360){k-=360}else{if(k<0){k+=360}}if(k<60){return f+(d-f)*k/60}if(k<180){return d}if(k<240){return f+(d-f)*(240-k)/60}return f}function j(k){return Math.round(b(k)*255)}return pv.rgb(j(i+120),j(i),j(i-120),this.a)};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};pv.Color.transparent=pv.rgb(0,0,0,0);pv.colors=function(){var a=pv.Scale.ordinal();a.range.apply(a,arguments);return a};pv.Colors={};pv.Colors.category10=function(){var a=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");a.domain.apply(a,arguments);return a};pv.Colors.category20=function(){var a=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");a.domain.apply(a,arguments);return a};pv.Colors.category19=function(){var a=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");a.domain.apply(a,arguments);return a};pv.ramp=function(d,a){var b=pv.Scale.linear();b.range.apply(b,arguments);return b};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",scale:1,implicit:{svg:{"shape-rendering":"auto",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(a){if(!a.length){return}if((a[0].reverse)&&(a.type!="line")&&(a.type!="area")){var f=pv.extend(a);for(var d=0,b=a.length-1;b>=0;d++,b--){f[d]=a[b]}a=f}this.removeSiblings(this[a.type](a))};pv.SvgScene.create=function(a){return document.createElementNS(this.svg,a)};pv.SvgScene.expect=function(h,f,a,d){if(h){if(h.tagName=="a"){h=h.firstChild}if(h.tagName!=f){var i=this.create(f);h.parentNode.replaceChild(i,h);h=i}}else{h=this.create(f)}for(var b in a){var g=a[b];if(g==this.implicit.svg[b]){g=null}if(g==null){h.removeAttribute(b)}else{h.setAttribute(b,g)}}for(var b in d){var g=d[b];if(g==this.implicit.css[b]){g=null}if(g==null){h.style.removeProperty(b)}else{h.style[b]=g}}return h};pv.SvgScene.append=function(d,a,b){d.$scene={scenes:a,index:b};d=this.title(d,a[b]);if(!d.parentNode){a.$g.appendChild(d)}return d.nextSibling};pv.SvgScene.title=function(f,d){var b=f.parentNode;if(b&&(b.tagName!="a")){b=null}if(d.title){if(!b){b=this.create("a");if(f.parentNode){f.parentNode.replaceChild(b,f)}b.appendChild(f)}b.setAttributeNS(this.xlink,"title",d.title);return b}if(b){b.parentNode.replaceChild(f,b)}return f};pv.SvgScene.dispatch=pv.listener(function(b){var a=b.target.$scene;if(a){pv.Mark.dispatch(b,a.scenes,a.index)}});pv.SvgScene.removeSiblings=function(a){while(a){var b=a.nextSibling;a.parentNode.removeChild(a);a=b}};pv.SvgScene.undefined=function(){};pv.SvgScene.area=function(a){var l=a.$g.firstChild;if(!a.length){return l}var q=a[0];if(q.segmented){return this.areaSegment(a)}if(!q.visible){return l}var n=q.fillStyle,o=q.strokeStyle;if(!n.opacity&&!o.opacity){return l}var b={"step-before":1,"step-after":2}[q.interpolate];function p(x,u){var B=[],A=[];for(var t=u;x<=t;x++,u--){var y=a[x],v=a[u],z=y.left+","+y.top,w=(v.left+v.width)+","+(v.top+v.height);if(b&&(x<t)){var s=a[x+1],d=a[u-1];if(b&1){z+="V"+s.top;w+="H"+(d.left+d.width)}else{z+="H"+s.left;w+="V"+(d.top+d.height)}}B.push(z);A.push(w)}return B.concat(A).join("L")}var m=[],k,g;for(var h=0;h<a.length;h++){k=a[h];if(!k.width&&!k.height){continue}for(var f=h+1;f<a.length;f++){g=a[f];if(!g.width&&!g.height){break}}if(h&&(b!=2)){h--}if((f<a.length)&&(b!=1)){f++}m.push(p(h,h=f-1))}if(!m.length){return l}l=this.expect(l,"path",{"shape-rendering":q.antialias?null:"crispEdges",cursor:q.cursor,d:"M"+m.join("ZM")+"Z",fill:n.color,"fill-opacity":n.opacity||null,stroke:o.color,"stroke-opacity":o.opacity||null,"stroke-width":o.opacity?q.lineWidth/this.scale:null});return this.append(l,a,0)};pv.SvgScene.areaSegment=function(a){var j=a.$g.firstChild;for(var h=0,d=a.length-1;h<d;h++){var l=a[h],k=a[h+1];if(!l.visible||!k.visible){continue}var m=l.fillStyle,o=l.strokeStyle;if(!m.opacity&&!o.opacity){continue}var g=l,f=k;switch(l.interpolate){case"step-before":g=k;break;case"step-after":f=l;break}var b=l.left+","+g.top+" "+k.left+","+f.top+" "+(k.left+k.width)+","+(f.top+f.height)+" "+(l.left+l.width)+","+(g.top+g.height);j=this.expect(j,"polygon",{"shape-rendering":l.antialias?null:"crispEdges",cursor:l.cursor,points:b,fill:m.color,"fill-opacity":m.opacity||null,stroke:o.color,"stroke-opacity":o.opacity||null,"stroke-width":o.opacity?l.lineWidth/this.scale:null});j=this.append(j,a,h)}return j};pv.SvgScene.bar=function(a){var h=a.$g.firstChild;for(var b=0;b<a.length;b++){var d=a[b];if(!d.visible){continue}var g=d.fillStyle,f=d.strokeStyle;if(!g.opacity&&!f.opacity){continue}h=this.expect(h,"rect",{"shape-rendering":d.antialias?null:"crispEdges",cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1e-10,d.width),height:Math.max(1e-10,d.height),fill:g.color,"fill-opacity":g.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null});h=this.append(h,a,b)}return h};pv.SvgScene.dot=function(a){var j=a.$g.firstChild;for(var b=0;b<a.length;b++){var o=a[b];if(!o.visible){continue}var l=o.fillStyle,m=o.strokeStyle;if(!l.opacity&&!m.opacity){continue}var g=o.radius,n;switch(o.shape){case"cross":n="M"+-g+","+-g+"L"+g+","+g+"M"+g+","+-g+"L"+-g+","+g;break;case"triangle":var f=g,k=g*1.1547;n="M0,"+f+"L"+k+","+-f+" "+-k+","+-f+"Z";break;case"diamond":g*=1.414214;n="M0,"+-g+"L"+g+",0 0,"+g+" "+-g+",0Z";break;case"square":n="M"+-g+","+-g+"L"+g+","+-g+" "+g+","+g+" "+-g+","+g+"Z";break;case"tick":n="M0,0L0,"+-o.size;break}var d={"shape-rendering":o.antialias?null:"crispEdges",fill:l.color,"fill-opacity":l.opacity||null,stroke:m.color,"stroke-opacity":m.opacity||null,"stroke-width":m.opacity?o.lineWidth/this.scale:null};if(n){d.transform="translate("+o.left+","+o.top+")";if(o.angle){d.transform+=" rotate("+180*o.angle/Math.PI+")"}d.d=n;j=this.expect(j,"path",d)}else{d.cx=o.left;d.cy=o.top;d.r=g;j=this.expect(j,"circle",d)}j=this.append(j,a,b)}return j};pv.SvgScene.image=function(a){var f=a.$g.firstChild;for(var b=0;b<a.length;b++){var d=a[b];if(!d.visible){continue}f=this.fill(f,a,b);f=this.expect(f,"image",{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});f.setAttributeNS(this.xlink,"href",d.url);f=this.append(f,a,b);f=this.stroke(f,a,b)}return f};pv.SvgScene.label=function(a){var f=a.$g.firstChild;for(var d=0;d<a.length;d++){var l=a[d];if(!l.visible){continue}var j=l.textStyle;if(!j.opacity||!l.text){continue}var h=0,g=0,k=0,b="start";switch(l.textBaseline){case"middle":k=".35em";break;case"top":k=".71em";g=l.textMargin;break;case"bottom":g="-"+l.textMargin;break}switch(l.textAlign){case"right":b="end";h="-"+l.textMargin;break;case"center":b="middle";break;case"left":h=l.textMargin;break}f=this.expect(f,"text",{"pointer-events":"none",x:h,y:g,dy:k,transform:"translate("+l.left+","+l.top+")"+(l.textAngle?" rotate("+180*l.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:j.color,"fill-opacity":j.opacity||null,"text-anchor":b},{font:l.font,"text-shadow":l.textShadow,"text-decoration":l.textDecoration});if(f.firstChild){f.firstChild.nodeValue=l.text}else{f.appendChild(document.createTextNode(l.text))}f=this.append(f,a,d)}return f};pv.SvgScene.line=function(a){var j=a.$g.firstChild;if(a.length<2){return j}var f=a[0];if(f.segmented){return this.lineSegment(a)}if(!f.visible){return j}var h=f.fillStyle,g=f.strokeStyle;if(!h.opacity&&!g.opacity){return j}var k="M"+f.left+","+f.top;for(var b=1;b<a.length;b++){k+=this.pathSegment(a[b-1],a[b])}j=this.expect(j,"path",{"shape-rendering":f.antialias?null:"crispEdges",cursor:f.cursor,d:k,fill:h.color,"fill-opacity":h.opacity||null,stroke:g.color,"stroke-opacity":g.opacity||null,"stroke-width":g.opacity?f.lineWidth/this.scale:null});return this.append(j,a,0)};pv.SvgScene.lineSegment=function(a){var g=a.$g.firstChild;for(var f=0,b=a.length-1;f<b;f++){var k=a[f],j=a[f+1];if(!k.visible||!j.visible){continue}var l=k.strokeStyle,m=pv.Color.transparent;if(!l.opacity){continue}var h;if(k.interpolate=="linear"){m=l;l=pv.Color.transparent;h=this.pathJoin(a[f-1],k,j,a[f+2])}else{h="M"+k.left+","+k.top+this.pathSegment(k,j)}g=this.expect(g,"path",{"shape-rendering":k.antialias?null:"crispEdges",cursor:k.cursor,d:h,fill:m.color,"fill-opacity":m.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?k.lineWidth/this.scale:null});g=this.append(g,a,f)}return g};pv.SvgScene.pathSegment=function(f,d){switch(f.interpolate){case"polar":var b=d.left-f.left,a=d.top-f.top,g=Math.sqrt(b*b+a*a)/2;return"A"+g+","+g+" 0 1,1 "+d.left+","+d.top;case"step-before":return"V"+d.top+"H"+d.left;case"step-after":return"H"+d.left+"V"+d.top}return"L"+d.left+","+d.top};pv.SvgScene.lineIntersect=function(f,d,b,a){return f.plus(d.times(b.minus(f).dot(a.perp())/d.dot(a.perp())))};pv.SvgScene.pathJoin=function(x,s,o,l){var u=pv.vector(s.left,s.top),q=pv.vector(o.left,o.top),f=q.minus(u),t=f.perp().norm(),n=t.times(s.lineWidth/(2*this.scale)),k=u.plus(n),i=q.plus(n),h=q.minus(n),g=u.minus(n);if(x&&x.visible){var m=u.minus(x.left,x.top).perp().norm().plus(t);g=this.lineIntersect(u,m,g,f);k=this.lineIntersect(u,m,k,f)}if(l&&l.visible){var j=pv.vector(l.left,l.top).minus(q).perp().norm().plus(t);h=this.lineIntersect(q,j,h,f);i=this.lineIntersect(q,j,i,f)}return"M"+k.x+","+k.y+"L"+i.x+","+i.y+" "+h.x+","+h.y+" "+g.x+","+g.y};pv.SvgScene.panel=function(b){var m=b.$g,n=m&&m.firstChild;for(var l=0;l<b.length;l++){var v=b[l];if(!v.visible){continue}if(!b.parent){v.canvas.style.display="inline-block";if(m&&(m.parentNode!=v.canvas)){m=v.canvas.firstChild;n=m&&m.firstChild}if(!m){m=v.canvas.appendChild(this.create("svg"));m.setAttribute("font-size","10px");m.setAttribute("font-family","sans-serif");m.setAttribute("fill","none");m.setAttribute("stroke","none");m.setAttribute("stroke-width",1.5);m.onclick=m.onmousedown=m.onmouseup=m.onmousemove=m.onmouseout=m.onmouseover=m.onmousewheel=this.dispatch;n=m.firstChild}b.$g=m;m.setAttribute("width",v.width+v.left+v.right);m.setAttribute("height",v.height+v.top+v.bottom)}if(v.overflow=="hidden"){var d=pv.id().toString(36),o=this.expect(n,"g",{"clip-path":"url(#"+d+")"});if(!o.parentNode){m.appendChild(o)}b.$g=m=o;n=o.firstChild;n=this.expect(n,"clipPath",{id:d});var a=n.firstChild||n.appendChild(this.create("rect"));a.setAttribute("x",v.left);a.setAttribute("y",v.top);a.setAttribute("width",v.width);a.setAttribute("height",v.height);if(!n.parentNode){m.appendChild(n)}n=n.nextSibling}n=this.fill(n,b,l);var f=this.scale,u=v.transform,q=v.left+u.x,p=v.top+u.y;this.scale*=u.k;for(var h=0;h<v.children.length;h++){v.children[h].$g=n=this.expect(n,"g",{transform:"translate("+q+","+p+")"+(u.k!=1?" scale("+u.k+")":"")});this.updateAll(v.children[h]);if(!n.parentNode){m.appendChild(n)}n=n.nextSibling}this.scale=f;n=this.stroke(n,b,l);if(v.overflow=="hidden"){b.$g=m=o.parentNode;n=o.nextSibling}}return n};pv.SvgScene.fill=function(g,a,b){var d=a[b],f=d.fillStyle;if(f.opacity){g=this.expect(g,"rect",{"shape-rendering":d.antialias?null:"crispEdges",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height,fill:f.color,"fill-opacity":f.opacity,stroke:null});g=this.append(g,a,b)}return g};pv.SvgScene.stroke=function(g,a,b){var d=a[b],f=d.strokeStyle;if(f.opacity){g=this.expect(g,"rect",{"shape-rendering":d.antialias?null:"crispEdges",cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1e-10,d.width),height:Math.max(1e-10,d.height),fill:null,stroke:f.color,"stroke-opacity":f.opacity,"stroke-width":d.lineWidth/this.scale});g=this.append(g,a,b)}return g};pv.SvgScene.rule=function(a){var g=a.$g.firstChild;for(var b=0;b<a.length;b++){var d=a[b];if(!d.visible){continue}var f=d.strokeStyle;if(!f.opacity){continue}g=this.expect(g,"line",{"shape-rendering":d.antialias?null:"crispEdges",cursor:d.cursor,x1:d.left,y1:d.top,x2:d.left+d.width,y2:d.top+d.height,stroke:f.color,"stroke-opacity":f.opacity,"stroke-width":d.lineWidth/this.scale});g=this.append(g,a,b)}return g};pv.SvgScene.wedge=function(b){var l=b.$g.firstChild;for(var k=0;k<b.length;k++){var w=b[k];if(!w.visible){continue}var u=w.fillStyle,v=w.strokeStyle;if(!u.opacity&&!v.opacity){continue}var g=w.innerRadius,f=w.outerRadius,o=Math.abs(w.angle),d;if(o>=2*Math.PI){if(g){d="M0,"+f+"A"+f+","+f+" 0 1,1 0,"+(-f)+"A"+f+","+f+" 0 1,1 0,"+f+"M0,"+g+"A"+g+","+g+" 0 1,1 0,"+(-g)+"A"+g+","+g+" 0 1,1 0,"+g+"Z"}else{d="M0,"+f+"A"+f+","+f+" 0 1,1 0,"+(-f)+"A"+f+","+f+" 0 1,1 0,"+f+"Z"}}else{var n=Math.min(w.startAngle,w.endAngle),m=Math.max(w.startAngle,w.endAngle),j=Math.cos(n),h=Math.cos(m),t=Math.sin(n),q=Math.sin(m);if(g){d="M"+f*j+","+f*t+"A"+f+","+f+" 0 "+((o<Math.PI)?"0":"1")+",1 "+f*h+","+f*q+"L"+g*h+","+g*q+"A"+g+","+g+" 0 "+((o<Math.PI)?"0":"1")+",0 "+g*j+","+g*t+"Z"}else{d="M"+f*j+","+f*t+"A"+f+","+f+" 0 "+((o<Math.PI)?"0":"1")+",1 "+f*h+","+f*q+"L0,0Z"}}l=this.expect(l,"path",{"shape-rendering":w.antialias?null:"crispEdges",cursor:w.cursor,transform:"translate("+w.left+","+w.top+")",d:d,fill:u.color,"fill-opacity":u.opacity||null,stroke:v.color,"stroke-opacity":v.opacity||null,"stroke-width":v.opacity?w.lineWidth/this.scale:null});l=this.append(l,b,k)}return l};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,a){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[b]=true;pv.Mark.prototype.propertyMethod(b,false,pv.Mark.cast[b]=a);return this};pv.Mark.prototype.propertyMethod=function(b,d,a){if(!a){a=pv.Mark.cast[b]}this[b]=function(g){if(d&&this.scene){var f=this.scene.defs;if(arguments.length){f[b]={id:(g==undefined)?0:pv.id(),value:((g!=null)&&a)?a(g):g};return this}return f[b]?f[b].value:null}if(arguments.length){var h=!d<<1|(typeof g=="function");this.propertyValue(b,(h&1&&a)?function(){var i=g.apply(this,arguments);return(i!=null)?a(i):null}:(((g!=null)&&a)?a(g):g)).type=h;return this}return this.instance()[b]}};pv.Mark.prototype.propertyValue=function(b,a){var f=this.$properties,g={name:b,id:pv.id(),value:a};for(var d=0;d<f.length;d++){if(f[d].name==b){f.splice(d,1);break}}f.push(g);return g};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype.defaults=new pv.Mark().data(function(a){return[a]}).visible(true).antialias(true);pv.Mark.prototype.extend=function(a){this.proto=a;return this};pv.Mark.prototype.add=function(a){return this.parent.add(a).extend(this)};pv.Mark.prototype.def=function(b,a){this.propertyMethod(b,true);return this[b](a)};pv.Mark.prototype.anchor=function(a){var b=this;return new pv.Anchor(this).name(a).data(function(){return b.scene.map(function(d){return d.data})}).visible(function(){return b.instance().visible})};pv.Mark.prototype.anchorTarget=function(){return this.proto.anchorTarget()};pv.Mark.prototype.instance=function(d){var b=this.scene||this.parent.instance(-1).children[this.childIndex],a=!arguments.length||this.hasOwnProperty("index")?this.index:d;return b[a<0?b.length-1:a]};pv.Mark.prototype.first=function(){return this.scene[0]};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]};pv.Mark.prototype.sibling=function(){return(this.index==0)?null:this.scene[this.index-1]};pv.Mark.prototype.cousin=function(){var b=this.parent,a=b&&b.sibling();return(a&&a.children)?a.children[this.childIndex][this.index]:null};pv.Mark.prototype.render=function(){var f=this.parent,a=pv.Mark.stack;if(f&&!this.root.scene){this.root.render();return}var b=[];for(var h=this;h.parent;h=h.parent){b.unshift(h.childIndex)}function d(o,l,k){o.scale=k;if(l<b.length){a.unshift(null);if(o.hasOwnProperty("index")){g(o,l,k)}else{for(var j=0,m=o.scene.length;j<m;j++){o.index=j;g(o,l,k)}delete o.index}a.shift()}else{o.build();pv.Scene.scale=k;pv.Scene.updateAll(o.scene)}delete o.scale}function g(p,m,l){var k=p.scene[p.index],j;if(k.visible){var o=b[m],n=p.children[o];for(j=0;j<o;j++){p.children[j].scene=k.children[j]}a[0]=k.data;if(n.scene){d(n,m+1,l*k.transform.k)}else{n.scene=k.children[o];d(n,m+1,l*k.transform.k);delete n.scene}for(j=0;j<o;j++){delete p.children[j].scene}}}this.bind();while(f&&!f.hasOwnProperty("index")){f=f.parent}this.context(f?f.scene:undefined,f?f.index:-1,function(){d(this.root,0,1)})};pv.Mark.stack=[];pv.Mark.prototype.bind=function(){var a={},k=[[],[],[],[]],j,d;function l(q){do{var n=q.$properties;for(var m=n.length-1;m>=0;m--){var o=n[m];if(!(o.name in a)){a[o.name]=o;switch(o.name){case"data":j=o;break;case"visible":d=o;break;default:k[o.type].push(o);break}}}}while(q=q.proto)}l(this);l(this.defaults);k[1].reverse();k[3].reverse();var f=this;do{for(var b in f.properties){if(!(b in a)){k[2].push(a[b]={name:b,type:2,value:null})}}}while(f=f.proto);var g=k[0].concat(k[1]);for(var h=0;h<g.length;h++){this.propertyMethod(g[h].name,true)}this.binds={properties:a,data:j,defs:g,required:[d],optional:pv.blend(k)}};pv.Mark.prototype.build=function(){var k=this.scene,b=pv.Mark.stack;if(!k){k=this.scene=[];k.mark=this;k.type=this.type;k.childIndex=this.childIndex;if(this.parent){k.parent=this.parent.scene;k.parentIndex=this.parent.index}}if(this.binds.defs.length){var a=k.defs;if(!a){k.defs=a={}}for(var f=0;f<this.binds.defs.length;f++){var j=this.binds.defs[f],l=a[j.name];if(!l||(j.id>l.id)){a[j.name]={id:0,value:(j.type&1)?j.value.apply(this,b):j.value}}}}var h=this.binds.data;h=h.type&1?h.value.apply(this,b):h.value;b.unshift(null);k.length=h.length;for(var f=0;f<h.length;f++){pv.Mark.prototype.index=this.index=f;var g=k[f];if(!g){k[f]=g={}}g.data=b[0]=h[f];this.buildInstance(g)}pv.Mark.prototype.index=-1;delete this.index;b.shift();return this};pv.Mark.prototype.buildProperties=function(f,d){for(var b=0,h=d.length;b<h;b++){var g=d[b],a=g.value;switch(g.type){case 0:case 1:a=this.scene.defs[g.name].value;break;case 3:a=a.apply(this,pv.Mark.stack);break}f[g.name]=a}};pv.Mark.prototype.buildInstance=function(a){this.buildProperties(a,this.binds.required);if(a.visible){this.buildProperties(a,this.binds.optional);this.buildImplied(a)}};pv.Mark.prototype.buildImplied=function(o){var g=o.left;var a=o.right;var n=o.top;var j=o.bottom;var f=this.properties;var k=f.width?o.width:0;var i=f.height?o.height:0;var d=this.parent?this.parent.width():(k+g+a);if(k==null){k=d-(a=a||0)-(g=g||0)}else{if(a==null){a=d-k-(g=g||0)}else{if(g==null){g=d-k-(a=a||0)}}}var m=this.parent?this.parent.height():(i+n+j);if(i==null){i=m-(n=n||0)-(j=j||0)}else{if(j==null){j=m-i-(n=n||0)}else{if(n==null){n=m-i-(j=j||0)}}}o.left=g;o.right=a;o.top=n;o.bottom=j;if(f.width){o.width=k}if(f.height){o.height=i}if(f.textStyle&&!o.textStyle){o.textStyle=pv.Color.transparent}if(f.fillStyle&&!o.fillStyle){o.fillStyle=pv.Color.transparent}if(f.strokeStyle&&!o.strokeStyle){o.strokeStyle=pv.Color.transparent}};pv.Mark.prototype.mouse=function(){var a=pv.event.pageX,g=pv.event.pageY,d=pv.Transform.identity,b=(this instanceof pv.Panel)?this:this.parent,f=this.root.canvas();do{a-=f.offsetLeft;g-=f.offsetTop}while(f=f.offsetParent);do{d=d.translate(b.left(),b.top()).times(b.transform())}while(b=b.parent);d=d.invert();return pv.vector(a*d.k+d.x,g*d.k+d.y)};pv.Mark.prototype.event=function(b,a){this.$handlers[b]=a;return this};pv.Mark.prototype.context=function(b,i,h){var d=pv.Mark.prototype,k=pv.Mark.stack,g=pv.Mark.scene,j=d.index;function l(s,m){pv.Mark.scene=s;d.index=m;if(!s){return}var q=s.mark,u=q,p=[];do{p.push(u);k.push(s[m].data);u.index=m;u.scene=s;m=s.parentIndex;s=s.parent}while(u=u.parent);for(var o=p.length-1,f=1;o>0;o--){u=p[o];u.scale=f;f*=u.scene[u.index].transform.k}if(q.children){for(var o=0,t=q.children.length;o<t;o++){u=q.children[o];u.scene=q.scene[q.index].children[o];u.scale=f}}}function a(p,f){if(!p){return}var o=p.mark,s;if(o.children){for(var m=0,q=o.children.length;m<q;m++){s=o.children[m];delete s.scene;delete s.scale}}s=o;do{k.pop();if(s.parent){delete s.scene;delete s.scale}delete s.index}while(s=s.parent)}a(g,j);l(b,i);try{h.apply(this,k)}finally{a(b,i);l(g,j)}};pv.Mark.dispatch=function(h,g,d){var a=g.mark,f=g.parent,b=a.$handlers[h.type];if(!b){return f&&pv.Mark.dispatch(h,f,g.parentIndex)}a.context(g,d,function(){a=b.apply(a,pv.Mark.stack);if(a&&a.render){a.render()}h.preventDefault()})};pv.Anchor=function(a){pv.Mark.call(this);this.target=a;this.parent=a.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.anchorTarget=function(){return this.target};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear");pv.Area.prototype.anchor=function(a){var b=this;return pv.Mark.prototype.anchor.call(this,a).left(function(){var d=b.instance();switch(this.name()){case"bottom":case"top":case"center":return d.left+d.width/2;case"right":return d.left+d.width}return null}).right(function(){var d=b.instance();switch(this.name()){case"bottom":case"top":case"center":return d.right+d.width/2;case"left":return d.right+d.width}return null}).top(function(){var d=b.instance();switch(this.name()){case"left":case"right":case"center":return d.top+d.height/2;case"bottom":return d.top+d.height}return null}).bottom(function(){var d=b.instance();switch(this.name()){case"left":case"right":case"center":return d.bottom+d.height/2;case"top":return d.bottom+d.height}return null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};pv.Area.prototype.buildImplied=function(a){if(a.height==null){a.height=0}if(a.width==null){a.width=0}pv.Mark.prototype.buildImplied.call(this,a)};pv.Area.fixed={lineWidth:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var d=this.binds,g=d.required,a=d.optional;for(var b=0,h=a.length;b<h;b++){var f=a[b];f.fixed=f.name in pv.Area.fixed;if(f.name=="segmented"){g.push(f);a.splice(b,1);b--;h--}}this.binds.$required=g;this.binds.$optional=a};pv.Area.prototype.buildInstance=function(d){var b=this.binds;if(this.index){var g=b.fixed;if(!g){g=b.fixed=[];function h(f){return !f.fixed||(g.push(f),false)}b.required=b.required.filter(h);if(!this.scene[0].segmented){b.optional=b.optional.filter(h)}}for(var a=0,k=g.length;a<k;a++){var j=g[a].name;d[j]=this.scene[0][j]}}else{b.required=b.$required;b.optional=b.$optional;b.fixed=null}pv.Mark.prototype.buildInstance.call(this,d)};pv.Bar=function(){pv.Mark.call(this)};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Bar.prototype.anchor=function(a){var b=this;return pv.Mark.prototype.anchor.call(this,a).left(function(){var d=b.instance();switch(this.name()){case"bottom":case"top":case"center":return d.left+(this.properties.width?0:d.width/2);case"right":return d.left+d.width}return null}).right(function(){var d=b.instance();switch(this.name()){case"bottom":case"top":case"center":return d.right+(this.properties.width?0:d.width/2);case"left":return d.right+d.width}return null}).top(function(){var d=b.instance();switch(this.name()){case"left":case"right":case"center":return d.top+(this.properties.height?0:d.height/2);case"bottom":return d.top+d.height}return null}).bottom(function(){var d=b.instance();switch(this.name()){case"left":case"right":case"center":return d.bottom+(this.properties.height?0:d.height/2);case"top":return d.bottom+d.height}return null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};pv.Dot=function(){pv.Mark.call(this)};pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));pv.Dot.prototype.anchor=function(a){var b=this;return pv.Mark.prototype.anchor.call(this,a).left(function(){var d=b.instance();switch(this.name()){case"bottom":case"top":case"center":return d.left;case"right":return d.left+d.radius}return null}).right(function(){var d=b.instance();switch(this.name()){case"bottom":case"top":case"center":return d.right;case"left":return d.right+d.radius}return null}).top(function(){var d=b.instance();switch(this.name()){case"left":case"right":case"center":return d.top;case"bottom":return d.top+d.radius}return null}).bottom(function(){var d=b.instance();switch(this.name()){case"left":case"right":case"center":return d.bottom;case"top":return d.bottom+d.radius}return null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})};pv.Dot.prototype.buildImplied=function(a){if(a.radius==null){a.radius=Math.sqrt(a.size)}else{if(a.size==null){a.size=a.radius*a.radius}}pv.Mark.prototype.buildImplied.call(this,a)};pv.Label=function(){pv.Mark.call(this)};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear");pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black");pv.Rule.prototype.anchor=function(a){return pv.Bar.prototype.anchor.call(this,a).textAlign(function(b){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(b){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})};pv.Rule.prototype.buildImplied=function(g){var d=g.left,h=g.right,f=g.top,a=g.bottom;if((g.width!=null)||((d==null)&&(h==null))||((h!=null)&&(d!=null))){g.height=0}else{g.width=0}pv.Mark.prototype.buildImplied.call(this,g)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(a){return(typeof a=="string")?document.getElementById(a):a});pv.Panel.prototype.type="panel";pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(a){var b=pv.extend(this);b.parent=this;b.instance=function(){var d=pv.extend(this.parent.instance());d.right=d.top=d.left=d.bottom=0;return d};return pv.Bar.prototype.anchor.call(b,a).data(function(f){return[f]})};pv.Panel.prototype.add=function(a){var b=new a();b.parent=this;b.root=this.root;b.childIndex=this.children.length;this.children.push(b);return b};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var a=0;a<this.children.length;a++){this.children[a].bind()}};pv.Panel.prototype.buildInstance=function(b){pv.Bar.prototype.buildInstance.call(this,b);if(!b.visible){return}if(!b.children){b.children=[]}var d=this.scale*b.transform.k,g,f=this.children.length;pv.Mark.prototype.index=-1;for(var a=0;a<f;a++){g=this.children[a];g.scene=b.children[a];g.scale=d;g.build()}for(var a=0;a<f;a++){g=this.children[a];b.children[a]=g.scene;delete g.scene;delete g.scale}b.children.length=f};pv.Panel.prototype.buildImplied=function(f){if(!this.parent){var i=f.canvas;if(i){if(i.$panel!=this){i.$panel=this;while(i.lastChild){i.removeChild(i.lastChild)}}var a,d;if(f.width==null){a=parseFloat(pv.css(i,"width"));f.width=a-f.left-f.right}if(f.height==null){d=parseFloat(pv.css(i,"height"));f.height=d-f.top-f.bottom}}else{var b=this.$canvas||(this.$canvas=[]);if(!(i=b[this.index])){i=b[this.index]=document.createElement("span");if(this.$dom){this.$dom.parentNode.insertBefore(i,this.$dom)}else{var g=document.body;while(g.lastChild&&g.lastChild.tagName){g=g.lastChild}if(g!=document.body){g=g.parentNode}g.appendChild(i)}}}f.canvas=i}if(!f.transform){f.transform=pv.Transform.identity}pv.Mark.prototype.buildImplied.call(this,f)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var a=this.sibling();return a?a.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2};pv.Wedge.prototype.anchor=function(b){function a(g){return(g.innerRadius+g.outerRadius)/2}function f(g){return(g.startAngle+g.endAngle)/2}var d=this;return pv.Mark.prototype.anchor.call(this,b).left(function(){var g=d.instance();switch(this.name()){case"outer":return g.left+g.outerRadius*Math.cos(f(g));case"inner":return g.left+g.innerRadius*Math.cos(f(g));case"start":return g.left+a(g)*Math.cos(g.startAngle);case"center":return g.left+a(g)*Math.cos(f(g));case"end":return g.left+a(g)*Math.cos(g.endAngle)}}).right(function(){var g=d.instance();switch(this.name()){case"outer":return g.right+g.outerRadius*Math.cos(f(g));case"inner":return g.right+g.innerRadius*Math.cos(f(g));case"start":return g.right+a(g)*Math.cos(g.startAngle);case"center":return g.right+a(g)*Math.cos(f(g));case"end":return g.right+a(g)*Math.cos(g.endAngle)}}).top(function(){var g=d.instance();switch(this.name()){case"outer":return g.top+g.outerRadius*Math.sin(f(g));case"inner":return g.top+g.innerRadius*Math.sin(f(g));case"start":return g.top+a(g)*Math.sin(g.startAngle);case"center":return g.top+a(g)*Math.sin(f(g));case"end":return g.top+a(g)*Math.sin(g.endAngle)}}).bottom(function(){var g=d.instance();switch(this.name()){case"outer":return g.bottom+g.outerRadius*Math.sin(f(g));case"inner":return g.bottom+g.innerRadius*Math.sin(f(g));case"start":return g.bottom+a(g)*Math.sin(g.startAngle);case"center":return g.bottom+a(g)*Math.sin(f(g));case"end":return g.bottom+a(g)*Math.sin(g.endAngle)}}).textAlign(function(){var g=d.instance();switch(this.name()){case"outer":return pv.Wedge.upright(f(g))?"right":"left";case"inner":return pv.Wedge.upright(f(g))?"left":"right"}return"center"}).textBaseline(function(){var g=d.instance();switch(this.name()){case"start":return pv.Wedge.upright(g.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(g.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var h=d.instance(),g=0;switch(this.name()){case"center":case"inner":case"outer":g=f(h);break;case"start":g=h.startAngle;break;case"end":g=h.endAngle;break}return pv.Wedge.upright(g)?g:(g+Math.PI)})};pv.Wedge.upright=function(a){a=a%(2*Math.PI);a=(a<0)?(2*Math.PI+a):a;return(a<Math.PI/2)||(a>3*Math.PI/2)};pv.Wedge.prototype.buildImplied=function(a){if(a.angle==null){a.angle=a.endAngle-a.startAngle}else{if(a.endAngle==null){a.endAngle=a.startAngle+a.angle}}pv.Mark.prototype.buildImplied.call(this,a)};pv.simulation=function(a){return new pv.Simulation(a)};pv.Simulation=function(b){for(var a=0;a<b.length;a++){this.particle(b[a])}};pv.Simulation.prototype.particle=function(a){a.next=this.particles;if(isNaN(a.px)){a.px=a.x}if(isNaN(a.py)){a.py=a.y}if(isNaN(a.fx)){a.fx=0}if(isNaN(a.fy)){a.fy=0}this.particles=a;return this};pv.Simulation.prototype.force=function(a){a.next=this.forces;this.forces=a;return this};pv.Simulation.prototype.constraint=function(a){a.next=this.constraints;this.constraints=a;return this};pv.Simulation.prototype.stabilize=function(f){if(!arguments.length){f=3}for(var a=0;a<f;a++){var b=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next){c.apply(this.particles,b)}}for(var d=this.particles;d;d=d.next){d.px=d.x;d.py=d.y}return this};pv.Simulation.prototype.step=function(){var h,g,i;for(h=this.particles;h;h=h.next){var b=h.px,a=h.py;h.px=h.x;h.py=h.y;if(h.fixed){continue}h.x+=h.vx=((h.x-b)+h.fx);h.y+=h.vy=((h.y-a)+h.fy)}var d=new pv.Quadtree(this.particles);for(i=this.constraints;i;i=i.next){i.apply(this.particles,d)}for(h=this.particles;h;h=h.next){h.fx=h.fy=0}for(g=this.forces;g;g=g.next){g.apply(this.particles,d)}for(h=this.particles;h;h=h.next){if(h.fixed){h.x=h.px;h.y=h.py}}};pv.Quadtree=function(j){var b;var d=Number.POSITIVE_INFINITY,h=d,a=Number.NEGATIVE_INFINITY,g=a;for(b=j;b;b=b.next){if(b.x<d){d=b.x}if(b.y<h){h=b.y}if(b.x>a){a=b.x}if(b.y>g){g=b.y}}var l=a-d,k=g-h;if(l>k){g=h+l}else{a=d+k}this.xMin=d;this.yMin=h;this.xMax=a;this.yMax=g;function i(w,u,q,t,o,s){if(w.leaf){if(w.p){if((Math.abs(w.p.x-u.x)+Math.abs(w.p.y-u.y))<0.01){f(w,u,q,t,o,s)}else{var m=w.p;w.p=null;f(w,m,q,t,o,s);f(w,u,q,t,o,s)}}else{w.p=u}}else{f(w,u,q,t,o,s)}}function f(t,q,s,x,o,v){var w=(s+o)*0.5,u=(x+v)*0.5,y=q.x>=w,m=q.y>=u;t.leaf=false;switch((m<<1)+y){case 0:t=t.c1||(t.c1=new pv.Quadtree.Node());break;case 1:t=t.c2||(t.c2=new pv.Quadtree.Node());break;case 2:t=t.c3||(t.c3=new pv.Quadtree.Node());break;case 3:t=t.c4||(t.c4=new pv.Quadtree.Node());break}if(y){s=w}else{o=w}if(m){x=u}else{v=u}i(t,q,s,x,o,v)}this.root=new pv.Quadtree.Node();for(b=j;b;b=b.next){i(this.root,b,d,h,a,g)}};pv.Quadtree.Node=function(){this.leaf=true;this.next=null;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null};pv.Force={};pv.Force.charge=function(f){var g=2,l=1/g,h=500,i=1/h,b=0.9,a={};if(!arguments.length){f=-40}a.constant=function(k){if(arguments.length){f=Number(k);return a}return f};a.domain=function(m,k){if(arguments.length){g=Number(m);l=1/g;h=Number(k);i=1/h;return a}return[g,h]};a.theta=function(k){if(arguments.length){b=Number(k);return a}return b};function j(p){var k=0,o=0;p.cn=0;function m(n){j(n);p.cn+=n.cn;k+=n.cn*n.cx;o+=n.cn*n.cy}if(!p.leaf){if(p.c1){m(p.c1)}if(p.c2){m(p.c2)}if(p.c3){m(p.c3)}if(p.c4){m(p.c4)}}if(p.p){p.cn+=f;k+=f*p.p.x;o+=f*p.p.y}p.cx=k/p.cn;p.cy=o/p.cn}function d(q,m,o,z,k,x){var B=q.cx-m.x,A=q.cy-m.y,u=1/Math.sqrt(B*B+A*A);if((q.leaf&&(q.p!=m))||((k-o)*u<b)){if(u<i){return}if(u>l){u=l}var v=q.cn*u*u*u,t=B*v,s=A*v;m.fx+=t;m.fy+=s}else{if(!q.leaf){var y=(o+k)*0.5,w=(z+x)*0.5;if(q.c1){d(q.c1,m,o,z,y,w)}if(q.c2){d(q.c2,m,y,z,k,w)}if(q.c3){d(q.c3,m,o,w,y,x)}if(q.c4){d(q.c4,m,y,w,k,x)}if(u<i){return}if(u>l){u=l}if(q.p&&(q.p!=m)){var v=f*u*u*u,t=B*v,s=A*v;m.fx+=t;m.fy+=s}}}}a.apply=function(k,m){j(m.root);for(var n=k;n;n=n.next){d(m.root,n,m.xMin,m.yMin,m.xMax,m.yMax)}};return a};pv.Force.drag=function(a){var b={};if(!arguments.length){a=0.1}b.constant=function(d){if(arguments.length){a=d;return b}return a};b.apply=function(d){if(a){for(var f=d;f;f=f.next){f.fx=a*(f.fx-f.x+f.px);f.fy=a*(f.fy-f.y+f.py)}}};return b};pv.Force.spring=function(f){var i=0.1,a=20,b,g,h={};if(!arguments.length){f=0.1}h.links=function(d){if(arguments.length){b=d;g=d.map(function(j){return 1/Math.sqrt(Math.max(j.sourceNode.linkDegree,j.targetNode.linkDegree))});return h}return b};h.constant=function(d){if(arguments.length){f=Number(d);return h}return f};h.damping=function(d){if(arguments.length){i=Number(d);return h}return i};h.length=function(d){if(arguments.length){a=Number(d);return h}return a};h.apply=function(t){for(var m=0;m<b.length;m++){var q=b[m].sourceNode,o=b[m].targetNode,v=q.x-o.x,u=q.y-o.y,n=Math.sqrt(v*v+u*u),s=n?(1/n):1,p=f*g[m],l=i*g[m],d=(p*(n-a)+l*(v*(q.vx-o.vx)+u*(q.vy-o.vy))*s)*s,k=-d*(n?v:(0.01*(0.5-Math.random()))),j=-d*(n?u:(0.01*(0.5-Math.random())));q.fx+=k;q.fy+=j;o.fx-=k;o.fy-=j}};return h};pv.Constraint={};pv.Constraint.collision=function(j){var f=1,g,i,b,h,a,d={};if(!arguments.length){r=10}d.repeat=function(l){if(arguments.length){f=Number(l);return d}return f};function k(t,q,s,C,o,A){if(!t.leaf){var B=(s+o)*0.5,z=(C+A)*0.5,y=z>b,m=z<a,u=B>i,D=B<h;if(y){if(t.c1&&u){k(t.c1,q,s,C,B,z)}if(t.c2&&D){k(t.c2,q,B,C,o,z)}}if(m){if(t.c3&&u){k(t.c3,q,s,z,B,A)}if(t.c4&&D){k(t.c4,q,B,z,o,A)}}}if(t.p&&(t.p!=q)){var F=q.x-t.p.x,E=q.y-t.p.y,v=Math.sqrt(F*F+E*E),x=g+j(t.p);if(v<x){var w=(v-x)/v*0.5;F*=w;E*=w;q.x-=F;q.y-=E;t.p.x+=F;t.p.y+=E}}}d.apply=function(o,s){var t,n,l=-Infinity;for(t=o;t;t=t.next){n=j(t);if(n>l){l=n}}for(var m=0;m<f;m++){for(t=o;t;t=t.next){n=(g=j(t))+l;i=t.x-n;h=t.x+n;b=t.y-n;a=t.y+n;k(s.root,t,s.xMin,s.yMin,s.xMax,s.yMax)}}};return d};pv.Constraint.link=function(b){var a={};if(!arguments.length){b=20}a.links=function(d){if(arguments.length){links=d;return a}return links};a.apply=function(o){for(var n=0;n<links.length;n++){var h=links[n].sourceNode,d=links[n].targetNode,m=h.x-d.x,g=h.y-d.y,f=Math.sqrt(m*m+g*g),j=(f-b)/f*0.5;m*=j;g*=j;h.x-=m;h.y-=g;d.x+=m;d.y+=g}};return a};pv.Constraint.position=function(d){var b=0.1,g={};if(!arguments.length){d=pv.identity}g.alpha=function(a){if(arguments.length){b=Number(a);return g}return b};g.apply=function(f){for(var h=f;h;h=h.next){var a=d(h);h.x+=(a.x-h.x)*b;h.y+=(a.y-h.y)*b}};return g};pv.Constraint.bound=function(){var b={},a,d;b.x=function(g,f){if(arguments.length){a={min:Math.min(g,f),max:Math.max(g,f)};return this}return a};b.y=function(g,f){if(arguments.length){d={min:Math.min(g,f),max:Math.max(g,f)};return this}return d};b.apply=function(f){if(a){for(var g=f;g;g=g.next){g.x=g.x<a.min?a.min:(g.x>a.max?a.max:g.x)}}if(d){for(var g=f;g;g=g.next){g.y=g.y<d.min?d.min:(g.y>d.max?d.max:g.y)}}};return b};pv.Layout=function(){pv.Mark.call(this)};pv.Layout.prototype=pv.extend(pv.Mark);pv.Layout.prototype.property=function(b,a){this.propertyMethod(b,true,a);return this};pv.Layout.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var a=this.binds,d=a.data,b=d.value;a.data={id:d.id,type:d.type|1,value:d.type&1?function(){var f=b.apply(this,arguments);this.init(f);return f}:function(){this.init(b);return b}}};pv.Layout.prototype.init=function(){};pv.Layout.Network=function(){pv.Layout.call(this);var a=this;this.node=new pv.Mark().data(function(){return a.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(b){return b.x}).top(function(b){return b.y});this.node.add=function(b){var d=a.parent.add(b).extend(this);d.link=a.link;d.node=a.node;d.label=a.label;return d};this.link=new pv.Mark().extend(this.node).data(function(b){return[b.sourceNode,b.targetNode]}).fillStyle(null).lineWidth(function(f,b){return b.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(b){var d=a.parent.add(pv.Panel).data(function(){return a.links()}).add(b).extend(this);d.link=a.link;d.node=a.node;d.label=a.label;return d};this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(b){return b.nodeName||b.nodeValue}).textAngle(function(d){var b=d.angle;return pv.Wedge.upright(b)?b:(b+Math.PI)}).textAlign(function(b){return pv.Wedge.upright(b.angle)?"left":"right"});this.label.add=this.node.add};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(a){return a.map(function(f,b){if(typeof f!="object"){f={nodeValue:f}}f.index=b;f.linkDegree=0;return f})}).property("links",function(a){return a.map(function(b){if(isNaN(b.linkValue)){b.linkValue=isNaN(b.value)?1:b.value}return b})});pv.Layout.Network.prototype.bind=function(){pv.Layout.prototype.bind.call(this);var d=this.binds,b=d.properties.nodes,a=d.properties.links;if(a&&(b.id>a.id)){a.id=b.id}};pv.Layout.Network.prototype.init=function(){var a=this.scene.defs;if(a.nodes.id){return true}a.links.id=a.nodes.id=pv.id();var b=this.nodes();this.links().forEach(function(i){var h=i.sourceNode||(i.sourceNode=b[i.source]),g=i.targetNode||(i.targetNode=b[i.target]),f=i.linkValue;h.linkDegree+=f;g.linkDegree+=f})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this)};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.data=pv.Layout.Hierarchy.prototype.nodes;pv.Layout.Hierarchy.prototype.bind=function(){pv.Layout.Network.prototype.bind.call(this);var a=this.binds;if(!a.properties.links){a.defs.push({name:"links",id:pv.id(),type:1,value:pv.Layout.Hierarchy.links})}};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(a){return a.parentNode}).map(function(a){return{sourceNode:a,targetNode:a.parentNode,linkDegree:1}})};pv.Layout.Grid=function(){pv.Layout.call(this);var a=this;this.data(function(b){return pv.range(a.rows()*a.cols()).map(function(){return b})});this.propertyMethod("data",false,function(b){a.rows(b.length).cols(b[0]?b[0].length:0);return pv.blend(b)});this.rows(1).cols(1).width(function(){return this.parent.width()/this.cols()}).height(function(){return this.parent.height()/this.rows()}).left(function(){return this.width()*(this.index%this.cols())}).top(function(){return this.height()*Math.floor(this.index/this.cols())})};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows",Number).property("cols",Number);pv.Layout.Stack=function(){pv.Layout.call(this);var a=this;this.add=function(b){var f=a.parent.add(pv.Panel).data(function(){var g=a.scene.$stack.data;a.prebuild(g,this.children[0]);return g}).visible(function(){return a.scene[this.index].visible}).add(b).data(pv.identity),d=f.bind;f.bind=function(){a.prebind(d,this)};return f}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("order",String).property("offset",String);pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom").order("unsorted").offset("zero");pv.Layout.Stack.prototype.init=function(a){this.scene.$stack={data:a}};pv.Layout.Stack.prototype.prebind=function(j,f){var g=f.binds?f.binds.$stack:{};j.call(f);var h={left:1,right:1,top:1,bottom:1,width:1,height:1};function k(d){return function(){return d}}var l=f.binds.properties;for(var a in h){var b=l[a];if(!b.original){var m=b.type&1?b.value:k(b.value),i=g[a]=f.propertyValue(a,m);i.type=3;i.original=m}}j.call(f);f.binds.$stack=g};pv.Layout.Stack.prototype.prebuild=function(U,p){var v=this.orient(),E=/^(top|bottom)$/.test(v),M=U.length,N=U[0].length,S=this.parent[E?"height":"width"](),I=[],H=[],f=[],G=[],u=p.parent,b=p.binds.$stack;var l=b[E?"height":"width"],t=E?b.left||b.right:b.top||b.bottom,s=b[v],w=l.original,A=t.original;var C=pv.Mark.stack;C.unshift(null);for(var R=0;R<M;R++){f[R]=[];H[R]=[];G[R]=this.scene[R].visible;u.index=R;for(var P=0;P<N;P++){C[0]=U[R][P];pv.Mark.prototype.index=p.index=P;if(!R){I[P]=A.apply(p,C)}f[R][P]=G[R]?w.apply(p,C):0}}delete u.index;delete p.index;C.shift();var F;switch(this.order()){case"inside-out":var B=f.map(function(h){return pv.max.index(h)}),D=pv.range(M).sort(function(i,h){return B[i]-B[h]}),Q=f.map(function(h){return pv.sum(h)}),q=0,d=0,a=[],J=[];for(var R=0;R<M;R++){var P=D[R];if(q<d){q+=Q[P];a.push(P)}else{d+=Q[P];J.push(P)}}F=J.reverse().concat(a);break;default:F=pv.range(M);break}switch(this.offset()){case"silohouette":for(var P=0;P<N;P++){var L=0;for(var R=0;R<M;R++){L+=f[R][P]}H[F[0]][P]=(S-L)/2}break;case"wiggle":var L=0;for(var R=0;R<M;R++){L+=f[R][0]}H[F[0]][0]=L=(S-L)/2;for(var P=1;P<N;P++){var W=0,V=0,g=I[P]-I[P-1];for(var R=0;R<M;R++){W+=f[R][P]}for(var R=0;R<M;R++){var T=(f[F[R]][P]-f[F[R]][P-1])/(2*g);for(var O=0;O<R;O++){T+=(f[F[O]][P]-f[F[O]][P-1])/g}V+=T*f[F[R]][P]}H[F[0]][P]=L-=W?V/W*g:0}break;case"expand":var K=pv.sum(G);for(var P=0;P<N;P++){H[F[0]][P]=0;var O=0;for(var R=0;R<M;R++){O+=f[R][P]}if(O){O=S/O;for(var R=0;R<M;R++){f[R][P]*=O}}else{O=S/K;for(var R=0;R<M;R++){f[R][P]=G[R]?O:0}}}break;default:for(var P=0;P<N;P++){H[F[0]][P]=0}break}for(var P=0;P<N;P++){var L=H[F[0]][P];for(var R=1;R<M;R++){L+=f[F[R-1]][P];H[F[R]][P]=L}}t.value=function(){return I[this.index]};s.value=function(){return H[this.parent.index][this.index]};l.value=function(){return f[this.parent.index][this.index]};return U};pv.Layout.treemap=function(p){var l=[],m,o,d=Number;function b(q){return m?Math.round(q):q}function n(u){var t={size:0,children:[],keys:l.slice()};for(var s in u){var v=u[s],q=d(v);l.push(s);if(isNaN(q)){v=n(v)}else{v={size:q,data:v,keys:l.slice()}}t.children.push(v);t.size+=v.size;l.pop()}t.children.sort(function(x,w){return x.size-w.size});return t}function f(t,q){t.size*=q;if(t.children){for(var s=0;s<t.children.length;s++){f(t.children[s],q)}}}function k(x,q){var y=-Infinity,t=Infinity,v=0;for(var u=0;u<x.length;u++){var w=x[u].size;if(w<t){t=w}if(w>y){y=w}v+=w}v=v*v;q=q*q;return Math.max(q*y/v,v/(q*t))}function i(t){var G=[],C=Infinity;var E=t.left+(o?o.left:0),D=t.top+(o?o.top:0),F=t.width-(o?o.left+o.right:0),B=t.height-(o?o.top+o.bottom:0),u=Math.min(F,B);f(t,F*B/t.size);function A(J){var H=pv.sum(J,function(L){return L.size}),y=(u==0)?0:b(H/u);for(var x=0,I=0;x<J.length;x++){var K=J[x],w=b(K.size/y);if(F==u){K.left=E+I;K.top=D;K.width=w;K.height=y}else{K.left=E;K.top=D+I;K.width=y;K.height=w}I+=w}if(F==u){if(K){K.width+=F-I}D+=y;B-=y}else{if(K){K.height+=B-I}E+=y;F-=y}u=Math.min(F,B)}var s=t.children.slice();while(s.length>0){var q=s[s.length-1];if(q.size<=0){s.pop();continue}G.push(q);var v=k(G,u);if(v<=C){s.pop();C=v}else{G.pop();A(G);G.length=0;C=Infinity}}if(G.length>0){A(G)}if(F==u){for(var z=0;z<G.length;z++){G[z].width+=F}}else{for(var z=0;z<G.length;z++){G[z].height+=B}}}function j(s){if(s.children){i(s);for(var q=0;q<s.children.length;q++){var t=s.children[q];t.depth=s.depth+1;j(t)}}}function a(s,t){if(s.children){for(var q=0;q<s.children.length;q++){a(s.children[q],t)}}if(o||!s.children){t.push(s)}return t}function h(){var q=n(p);q.left=0;q.top=0;q.width=this.parent.width();q.height=this.parent.height();q.depth=0;j(q);return a(q,[]).reverse()}var g=new pv.Mark().data(h).left(function(q){return q.left}).top(function(q){return q.top}).width(function(q){return q.width}).height(function(q){return q.height});g.round=function(q){m=q;return this};g.inset=function(u,s,q,t){if(arguments.length){if(arguments.length==1){s=q=t=u}o={top:u,right:s,bottom:q,left:t};return this}return o};g.root=function(q){l=[q];return this};g.size=function(q){d=q;return this};return g};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.init=function(){if(pv.Layout.Hierarchy.prototype.init.call(this)){return}var n=this.nodes(),i=this.orient(),z=this.depth(),k=this.breadth(),b=this.group(),j=this.parent.width(),s=this.parent.height();function u(x){var w,B,h;if(!x.firstChild){if(w=x.previousSibling){x.prelim=w.prelim+a(x.depth,true)}}else{w=x.firstChild;B=x.lastChild;h=w;for(var C=w;C;C=C.nextSibling){u(C);h=m(C,h)}g(x);var y=0.5*(w.prelim+B.prelim);if(w=x.previousSibling){x.prelim=w.prelim+a(x.depth,true);x.mod=x.prelim-y}else{x.prelim=y}}}function o(w,h,x){w.breadth=w.prelim+h;h+=w.mod;for(var y=w.firstChild;y;y=y.nextSibling){o(y,h,x)}}function m(L,J){var K=L.previousSibling;if(K){var B=L,y=L,D=K,C=L.parentNode.firstChild,F=B.mod,E=y.mod,H=D.mod,G=C.mod,I=A(D),h=q(B);while(I&&h){D=I;B=h;C=q(C);y=A(y);y.ancestor=L;var x=(D.prelim+H)-(B.prelim+F)+a(D.depth,false);if(x>0){l(v(D,L,J),L,x);F+=x;E+=x}H+=D.mod;F+=B.mod;G+=C.mod;E+=y.mod;I=A(D);h=q(B)}if(I&&!A(y)){y.thread=I;y.mod+=H-E}if(h&&!q(C)){C.thread=h;C.mod+=F-G;J=L}}return J}function q(h){return h.firstChild||h.thread}function A(h){return h.lastChild||h.thread}function l(x,w,h){var y=w.number-x.number;w.change-=h/y;w.shift+=h;x.change+=h/y;w.prelim+=h;w.mod+=h}function g(w){var h=0,y=0;for(var x=w.lastChild;x;x=x.previousSibling){x.prelim+=h;x.mod+=h;y+=x.change;h+=x.shift+y}}function v(x,w,h){return(x.ancestor.parentNode==w.parentNode)?x.ancestor:h}function a(w,h){return(h?1:(b+1))/((i=="radial")?w:1)}var p=n[0];p.visitAfter(function(h,w){h.ancestor=h;h.prelim=0;h.mod=0;h.change=0;h.shift=0;h.number=h.previousSibling?(h.previousSibling.number+1):0;h.depth=w});u(p);o(p,-p.prelim,0);function t(h){return(i=="radial")?h.breadth/z:(h.firstChild?Math.PI:0)}function f(h){switch(i){case"left":return h.depth;case"right":return j-h.depth;case"top":case"bottom":return h.breadth+j/2;case"radial":return j/2+h.depth*Math.cos(t(h))}}function d(h){switch(i){case"left":case"right":return h.breadth+s/2;case"top":return h.depth;case"bottom":return s-h.depth;case"radial":return s/2+h.depth*Math.sin(t(h))}}p.visitAfter(function(h){h.breadth*=k;h.depth*=z;h.angle=t(h);h.x=f(h);h.y=d(h);delete h.breadth;delete h.depth;delete h.ancestor;delete h.prelim;delete h.mod;delete h.change;delete h.shift;delete h.number})};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after").strokeStyle("#ccc")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.init=function(){if(pv.Layout.Hierarchy.prototype.init.call(this)){return}var b=this.nodes(),h=this.breadth(),g=this.depth(),f=0,d=0;function a(l,k,i){l.x=f+i++*g;l.y=d+k++*h;l.angle=0;for(var j=l.firstChild;j;j=j.nextSibling){k=a(j,k,i)}return k}a(b[0],1,1)};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);var a=this.node.radius(function(b){return b.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.add=function(b){return this.parent.add(b).extend(a)};delete this.node;delete this.label;delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1);pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(a){this.$radius=typeof a=="function"?function(){return Math.sqrt(a.apply(this,arguments))}:(a=Math.sqrt(a),function(){return a});return this};pv.Layout.Pack.prototype.init=function(){if(pv.Layout.Hierarchy.prototype.init.call(this)){return}var l=this,m;function i(k){var h=pv.Mark.stack;h.unshift(null);for(var q=0,t=k.length;q<t;q++){var s=k[q];if(!s.firstChild){h[0]=s.nodeValue;s.radius=l.$radius.apply(l,h)}}h.shift()}function p(q){var h=[];for(var k=q.firstChild;k;k=k.nextSibling){if(k.firstChild){k.radius=p(k)}k.n=k.p=k;h.push(k)}h.sort(function(t,s){return t.radius-s.radius});return g(h)}function g(C){var G=Infinity,K=-Infinity,h=Infinity,w=-Infinity,J,I,H,E,D;function s(k){G=Math.min(k.x-k.radius,G);K=Math.max(k.x+k.radius,K);h=Math.min(k.y-k.radius,h);w=Math.max(k.y+k.radius,w)}function t(M,k){var N=M.n;M.n=k;k.p=M;k.n=N;N.p=k}function L(M,k){M.n=k;k.p=M}function u(N,k){var O=k.x-N.x,M=k.y-N.y,P=N.radius+k.radius;return(P*P-O*O-M*M)>0.001}J=C[0];J.x=-J.radius;J.y=0;s(J);if(C.length>1){I=C[1];I.x=I.radius;I.y=0;s(I);if(C.length>2){H=C[2];f(J,I,H);s(H);t(J,H);J.p=H;t(H,I);I=J.n;for(var F=3;F<C.length;F++){f(J,I,H=C[F]);var q=0,x=1,v=1;for(E=I.n;E!=I;E=E.n,x++){if(u(E,H)){q=1;break}}if(q==1){for(D=J.p;D!=E.p;D=D.p,v++){if(u(D,H)){if(v<x){q=-1;E=D}break}}}if(q==0){t(J,H);I=H;s(H)}else{if(q>0){L(J,E);I=E;F--}else{if(q<0){L(E,I);J=E;F--}}}}}}var z=(G+K)/2,y=(h+w)/2,A=0;for(var F=0;F<C.length;F++){var B=C[F];B.x-=z;B.y-=y;A=Math.max(A,B.radius+Math.sqrt(B.x*B.x+B.y*B.y))}return A+m}function f(v,t,s){var B=t.radius+s.radius,z=v.radius+s.radius,C=t.x-v.x,A=t.y-v.y,y=Math.sqrt(C*C+A*A),w=(z*z+y*y-B*B)/(2*z*y),k=Math.acos(w),u=w*z,q=Math.sin(k)*z;C/=y;A/=y;s.x=v.x+u*C+q*A;s.y=v.y+u*A-q*C}function b(u,h,t,q){for(var s=u.firstChild;s;s=s.nextSibling){s.x+=u.x;s.y+=u.y;b(s,h,t,q)}u.x=h+q*u.x;u.y=t+q*u.y;u.radius*=q}var a=this.nodes();m=this.spacing();i(a);var n=a[0];n.x=0;n.y=0;n.radius=p(n);var o=this.parent.width(),j=this.parent.height(),d=1/Math.max(2*n.radius/o,2*n.radius/j);b(n,o/2,j/2,d)};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,a){return Math.sqrt(a.linkValue)*1.5})};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number);pv.Layout.Force.prototype.init=function(){if(pv.Layout.Network.prototype.init.call(this)){return}var a=this.nodes(),t=this.links();var q=this.parent.width(),k=this.parent.height(),o=q/2,m=k/2;for(var j=0;j<a.length;j++){var b=a[j],f=Math.random()*2*Math.PI;b.x=o+=10*(q/k)*Math.cos(f);b.y=m+=10*(k/q)*Math.sin(f)}var l=pv.simulation(a);l.force(pv.Force.drag());l.force(pv.Force.charge());l.force(pv.Force.spring().links(t));if(this.bound()){l.constraint(pv.Constraint.bound().x(6,q-6).y(6,k-6))}var b=this.iterations();if(b==null){function d(h){return h.fixed?1:h.vx*h.vx+h.vy*h.vy}l.step();var s=1,g=0.0001*(t.length+1),p=this.parent;setInterval(function(){if(s>g){var h=Date.now();do{l.step()}while(Date.now()-h<20);p.render()}s=pv.max(a,d)},42)}else{for(var j=0;j<b;j++){l.step()}}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var a,b=this.init;this.init=function(){var d=this.orient();a=/^(top|bottom)$/.test(d)?"step-before":/^(left|right)$/.test(d)?"step-after":"linear";b.call(this)};this.link.strokeStyle("#ccc").interpolate(function(){return a})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.init=function(){if(pv.Layout.Hierarchy.prototype.init.call(this)){return}var u=this.nodes(),l=this.orient(),B=this.group(),m=this.parent.width(),A=this.parent.height(),o=Math.min(m,A)/2;function D(i){var g=0;for(var h=i.firstChild;h;h=h.nextSibling){g=Math.max(g,1+D(h))}return i.depth=g}var v=u[0],q=1/D(v);var a=0,s;v.visitAfter(function(g){if(!g.firstChild){if(B&&(s!=g.parentNode)){s=g.parentNode;a+=B}a++}});var b=0.5-B/2,f=1/a,s=undefined;v.visitAfter(function(i){if(i.firstChild){var g=0;for(var h=i.firstChild;h;h=h.nextSibling){g+=h.breadth}g/=i.childNodes.length}else{if(B&&(s!=i.parentNode)){s=i.parentNode;b+=B}g=f*b++}i.breadth=g;i.depth=1-i.depth/v.depth});v.visitAfter(function(g){g.minBreadth=g.firstChild?g.firstChild.minBreadth:(g.breadth-f/2);g.maxBreadth=g.firstChild?g.lastChild.maxBreadth:(g.breadth+f/2)});v.visitBefore(function(g){g.minDepth=g.parentNode?g.parentNode.maxDepth:0;g.maxDepth=g.parentNode?(g.depth+v.depth):(g.minDepth+2*v.depth)});v.minDepth=-q;function d(g){return g.parentNode?(g.depth*o):0}function C(g){return(l=="radial")?(g.parentNode?(g.breadth-0.25)*2*Math.PI:0):(g.firstChild?Math.PI:0)}function k(g){switch(l){case"left":return g.depth*m;case"right":return m-g.depth*m;case"top":return g.breadth*m;case"bottom":return m-g.breadth*m;case"radial":return m/2+d(g)*Math.cos(C(g))}}function j(g){switch(l){case"left":return g.breadth*A;case"right":return A-g.breadth*A;case"top":return g.depth*A;case"bottom":return A-g.depth*A;case"radial":return A/2+d(g)*Math.sin(C(g))}}for(var z=0;z<u.length;z++){var t=u[z];t.x=k(t);t.y=j(t);t.angle=C(t)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);var a=this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(b){return b.width}).height(function(b){return b.height}).innerRadius(function(b){return b.innerRadius}).outerRadius(function(b){return b.outerRadius}).startAngle(function(b){return b.startAngle}).endAngle(function(b){return b.endAngle});this.add=function(b){return this.parent.add(b).extend(a)};delete this.node;delete this.label;delete this.link};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.init=function(){if(pv.Layout.Cluster.prototype.init.call(this)){return}var s=this.nodes(),g=this.orient(),b=this.group(),j=this.parent.width(),z=this.parent.height(),k=Math.min(j,z)/2,m=-s[0].minDepth;function A(i,h){return(i+h)/(1+h)}function f(h){switch(g){case"left":return A(h.minDepth,m)*j;case"right":return(1-A(h.maxDepth,m))*j;case"top":return h.minBreadth*j;case"bottom":return(1-h.maxBreadth)*j;case"radial":return j/2}}function d(h){switch(g){case"left":return h.minBreadth*z;case"right":return(1-h.maxBreadth)*z;case"top":return A(h.minDepth,m)*z;case"bottom":return(1-A(h.maxDepth,m))*z;case"radial":return z/2}}function q(h){switch(g){case"left":case"right":return(h.maxDepth-h.minDepth)/(1+m)*j;case"top":case"bottom":return(h.maxBreadth-h.minBreadth)*j}}function l(h){switch(g){case"left":case"right":return(h.maxBreadth-h.minBreadth)*z;case"top":case"bottom":return(h.maxDepth-h.minDepth)/(1+m)*z}}function a(h){return Math.max(0,A(h.minDepth,m/2))*k}function t(h){return A(h.maxDepth,m/2)*k}function u(h){return(h.parentNode?h.minBreadth-0.25:0)*2*Math.PI}function p(h){return(h.parentNode?h.maxBreadth-0.25:1)*2*Math.PI}for(var v=0;v<s.length;v++){var o=s[v];o.x=f(o);o.y=d(o);o.width=q(o);o.height=l(o);o.innerRadius=a(o);o.outerRadius=t(o);o.startAngle=u(o);o.endAngle=p(o)}};pv.Layout.partition=function(b){var d,n,g=function(h){return 1},k="top",s,o,a,f;function t(h){return h.size=h.firstChild?pv.sum(h.childNodes,t):g(h.nodeValue)}function m(h){return h.firstChild?(1+pv.max(h.childNodes,m)):0}function l(){s=this.parent.width();o=this.parent.height();a=Math.min(s,o)/2;if(d){return d}d=pv.dom(b).nodes();var h=d[0];t(h);if(n){h.sort(n)}f=1/m(h);h.minBreadth=0;h.breadth=0.5;h.maxBreadth=1;h.visitBefore(function(x){var u=x.minBreadth,v=x.maxBreadth-u;for(var w=x.firstChild;w;w=w.nextSibling){w.minBreadth=u;w.maxBreadth=u+=(w.size/x.size)*v;w.breadth=(u+w.minBreadth)/2}});h.visitAfter(function(v,u){v.minDepth=(u-1)*f;v.maxDepth=v.depth=u*f});return d}var p={};p.orient=function(h){if(arguments.length){k=h;return this}return k};p.sort=function(h){if(arguments.length){n=h;return this}return n};p.nodes=l;p.links=function(){return l.call(this).filter(function(h){return h.parentNode}).map(function(h){return[h,h.parentNode]})};p.size=function(h){if(arguments.length){g=h;return this}return g};function q(h){return h.parentNode?(h.depth*a):0}function j(h){return h.parentNode?(h.breadth-0.25)*2*Math.PI:0}function i(u,h){return(u+h)/(1+h)}p.node=new pv.Mark().data(l).strokeStyle("#1f77b4").fillStyle("#fff").left(function(h){switch(k){case"left":return h.depth*s;case"right":return s-h.depth*s;case"top":return h.breadth*s;case"bottom":return s-h.breadth*s;case"radial":return s/2+q(h)*Math.cos(j(h))}}).top(function(h){switch(k){case"left":return h.breadth*o;case"right":return o-h.breadth*o;case"top":return h.depth*o;case"bottom":return o-h.depth*o;case"radial":return o/2+q(h)*Math.sin(j(h))}});p.link=new pv.Mark().extend(p.node).data(pv.identity).strokeStyle("#ccc").fillStyle(null);p.label=new pv.Mark().extend(p.node).textMargin(7).textBaseline("middle").text(function(h){return h.parentNode?h.nodeName:"root"}).textAngle(function(u){if(k!="radial"){return 0}var h=j(u);return pv.Wedge.upright(h)?h:(h+Math.PI)}).textAlign(function(h){if(k!="radial"){return h.firstChild?"right":"left"}return pv.Wedge.upright(j(h))?"left":"right"});p.fill=new pv.Mark().data(l).strokeStyle("#fff").fillStyle("#ccc").left(function(h){switch(k){case"left":return i(h.minDepth,f)*s;case"right":return(1-i(h.maxDepth,f))*s;case"top":return h.minBreadth*s;case"bottom":return(1-h.maxBreadth)*s;case"radial":return s/2}}).top(function(h){switch(k){case"left":return h.minBreadth*o;case"right":return(1-h.maxBreadth)*o;case"top":return i(h.minDepth,f)*o;case"bottom":return(1-i(h.maxDepth,f))*o;case"radial":return o/2}}).width(function(h){switch(k){case"left":case"right":return(h.maxDepth-h.minDepth)/(1+f)*s;case"top":case"bottom":return(h.maxBreadth-h.minBreadth)*s}}).height(function(h){switch(k){case"left":case"right":return(h.maxBreadth-h.minBreadth)*o;case"top":case"bottom":return(h.maxDepth-h.minDepth)/(1+f)*o}}).innerRadius(function(h){return Math.max(0,i(h.minDepth,f/2))*a}).outerRadius(function(h){return i(h.maxDepth,f/2)*a}).startAngle(function(h){return(h.minBreadth-0.25)*2*Math.PI}).endAngle(function(h){return(h.maxBreadth-0.25)*2*Math.PI});return p};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,d,a,f=this.init;this.init=function(){var g=this.orient();d=this.directed();b=g=="radial"?"linear":"polar";a=g=="right"||g=="top";f.call(this)};this.link.data(function(i){var h=i.sourceNode,g=i.targetNode;return a!=(d||(h.index<g.index))?[h,g]:[g,h]}).interpolate(function(){return b})};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.init=function(){if(pv.Layout.Network.prototype.init.call(this)){return}var d=this.nodes(),j=this.orient(),p=this.parent.width(),l=this.parent.height(),b=Math.min(p,l)/2;function g(h){switch(j){case"top":return -Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(h-0.25)*2*Math.PI}}function o(h){switch(j){case"top":case"bottom":return h*p;case"left":return 0;case"right":return p;case"radial":return p/2+b*Math.cos(g(h))}}function m(h){switch(j){case"top":return 0;case"bottom":return l;case"left":case"right":return h*l;case"radial":return l/2+b*Math.sin(g(h))}}for(var k=0;k<d.length;k++){var a=(k+0.5)/d.length,f=d[k];f.x=o(a);f.y=m(a);f.angle=g(a)}};pv.Layout.Horizon=function(){pv.Layout.call(this);var g=true,b,f,a;function d(){b=Math.round(this.parent.height());g=this.mode()=="mirror";var i=this.bands(),h=this.backgroundStyle();f=pv.Scale.linear(0,i).range(h,this.negativeStyle());a=pv.Scale.linear(0,i).range(h,this.positiveStyle());return pv.range(i*2)}this.propertyValue("fillStyle",function(h){return h?null:this.backgroundStyle()}).type=3;this.bands(2).mode("offset").backgroundStyle("white").negativeStyle("red").positiveStyle("blue").data(d).overflow("hidden").height(function(){return b}).transform(function(h){var j=Math.floor((h+1)/2)*b*(!g&&(h%2)?-1:1);return pv.Transform.identity.translate(0,j)});this.band=new pv.Mark().top(function(j,h){return g&&(h%2)?0:null}).bottom(function(j,h){return g&&(h%2)?null:0}).fillStyle(function(j,h){return((h%2)?f:a)((h>>1)+1)})};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("negativeStyle",pv.color).property("positiveStyle",pv.color);pv.Layout.Horizon.prototype.add=function(a){return pv.Mark.prototype.add.call(this,pv.Panel).add(a).extend(this.band)};pv.Layout.Horizon.prototype.fillStyle=pv.Layout.Horizon.prototype.backgroundStyle;pv.Behavior={};pv.Behavior.drag=function(){var g,b,f,i;function a(k){b=this.index;g=this.scene;var j=this.mouse();i=pv.vector(k.x,k.y).minus(j);f=k;f.fixed=true}function d(){if(!g){return}g.mark.context(g,b,function(){var j=this.mouse();f.x=i.x+j.x;f.y=i.y+j.y})}function h(){if(!g){return}d();f.fixed=false;f=null;g=null}pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",h);return a};pv.Behavior.point=function(a){var j,i=null,h=1,g=1,d=arguments.length?a*a:900;function b(l){var m=document.createEvent("MouseEvents");m.initEvent(l,true,false);return m}function k(x,y){var C=x.mark.mouse(),F=x[y],A={cost:Infinity,distance:Infinity};for(var w=0,q=F.children.length;w<q;w++){var o=F.children[w],l;if(o.mark.type=="panel"){for(var u=0,t=o.length;u<t;u++){l=k(o,u);if(l.cost<A.cost){A=l}}}else{if(o.mark.$handlers.point){for(var u=0,t=o.length;u<t;u++){var z=o[u],E=C.x-z.left,D=C.y-z.top,B=h*E*E+g*D*D;if(B<A.cost){A.distance=E*E+D*D;A.cost=B;A.scene=o;A.index=u}}}}}return A}function f(){var l=k(this.scene,this.index);if(l.distance>d){l=null}if(j){if(l&&(j.scene==l.scene)&&(j.index==l.index)){return}pv.Mark.dispatch(b("unpoint"),j.scene,j.index)}if(j=l){pv.Mark.dispatch(b("point"),l.scene,l.index)}}f.collapse=function(l){if(arguments.length){i=String(l);switch(i){case"y":h=1;g=0;break;case"x":h=0;g=1;break;default:h=1;g=1;break}return f}return i};return f};pv.Behavior.select=function(i){var k,n,j,a,l,m;function d(){var f=k,p=a,o=j;do{f.index=o;f.scene=p;o=p.parentIndex;p=p.parent}while(f=f.parent)}function b(){k=this;j=k.index;a=k.scene;n=this.mouse();m={};m.left=n.x;m.top=n.y;m.right=k.width()-n.x;m.bottom=k.height()-n.y;m.width=0;m.height=0;l=Array.prototype.concat.apply([m],arguments);i.apply(this,l)}function h(){if(!k){return}d();var f=k.mouse();m.left=Math.max(0,Math.min(n.x,f.x));m.top=Math.max(0,Math.min(n.y,f.y));m.right=Math.max(0,k.width()-Math.max(n.x,f.x));m.bottom=Math.max(0,k.height()-Math.max(n.y,f.y));m.width=Math.max(0,k.width()-m.left-m.right);m.height=Math.max(0,k.height()-m.top-m.bottom);i.apply(k,l)}function g(){h();k=null}pv.listen(window,"mousemove",h);pv.listen(window,"mouseup",g);return b};pv.Behavior.pan=function(){var h,f,d,j,a;function b(){f=this.index;h=this.scene;j=pv.vector(pv.event.pageX,pv.event.pageY);d=this.transform();a=1/(d.k*this.scale)}function g(){if(!h){return}h.mark.context(h,f,function(){var k=(pv.event.pageX-j.x)*a,l=(pv.event.pageY-j.y)*a;this.transform(d.translate(k,l)).render()})}function i(){g();h=null}pv.listen(window,"mousemove",g);pv.listen(window,"mouseup",i);return b};pv.Behavior.zoom=function(){return function(){var b=this.mouse(),a=window.event.wheelDelta;this.transform(this.transform().translate(b.x,b.y).scale((a<0)?(1000/(1000-a)):((1000+a)/1000)).translate(-b.x,-b.y)).render()}};pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};for(;pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.textContent||pv.$.s.innerHTML))}catch(e){pv.error(e)}}}delete pv.$});